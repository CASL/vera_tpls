<center><a href="bddc.c">Actual source code: bddc.c</a></center><br>

<html>
<head> <link rel="canonical" href="http://www.mcs.anl.gov/petsc/petsc-current/src/ksp/pc/impls/bddc/bddc.c.html" />
<title></title>
<meta name="generator" content="c2html 0.9.5">
<meta name="date" content="2015-05-23T23:31:46+00:00">
</head>

<body bgcolor="#FFFFFF">
   <div id="version" align=right><b>petsc-3.5.4 2015-05-23</b></div>
   <div id="bugreport" align=right><a href="mailto:petsc-maint@mcs.anl.gov?subject=Typo or Error in Documentation &body=Please describe the typo or error in the documentation: petsc-3.5.4 v3.5.3-68-g9fbf19a src/ksp/pc/impls/bddc/bddc.c.html "><small>Report Typos and Errors</small></a></div>
<pre width="80"><a name="line1">  1: </a><font color="#B22222">/* TODOLIST</font>

<a name="line3">  3: </a><font color="#B22222">   ConstraintsSetup</font>
<a name="line4">  4: </a><font color="#B22222">   - tolerances for constraints as an option (take care of single precision!)</font>

<a name="line6">  6: </a><font color="#B22222">   Solvers</font>
<a name="line7">  7: </a><font color="#B22222">   - Add support for cholesky for coarse solver (similar to local solvers)</font>
<a name="line8">  8: </a><font color="#B22222">   - Propagate ksp prefixes for solvers to mat objects?</font>
<a name="line9">  9: </a><font color="#B22222">   - Propagate nearnullspace info among levels</font>

<a name="line11"> 11: </a><font color="#B22222">   User interface</font>
<a name="line12"> 12: </a><font color="#B22222">   - ** DofSplitting and DM attached to pc?</font>

<a name="line14"> 14: </a><font color="#B22222">   Debugging output</font>
<a name="line15"> 15: </a><font color="#B22222">   - * Better management of verbosity levels of debugging output</font>

<a name="line17"> 17: </a><font color="#B22222">   Build</font>
<a name="line18"> 18: </a><font color="#B22222">   - make runexe59</font>

<a name="line20"> 20: </a><font color="#B22222">   Extra</font>
<a name="line21"> 21: </a><font color="#B22222">   - ** GetRid of PCBDDCApplySchur, use MatSchur instead</font>
<a name="line22"> 22: </a><font color="#B22222">   - *** Is it possible to work with PCBDDCGraph on boundary indices only (less memory consumed)?</font>
<a name="line23"> 23: </a><font color="#B22222">   - add support for computing h,H and related using coordinates?</font>
<a name="line24"> 24: </a><font color="#B22222">   - Change of basis approach does not work with my nonlinear mechanics example. why? (seems not an issue with l2gmap)</font>
<a name="line25"> 25: </a><font color="#B22222">   - Better management in PCIS code</font>
<a name="line26"> 26: </a><font color="#B22222">   - BDDC with MG framework?</font>

<a name="line28"> 28: </a><font color="#B22222">   FETIDP</font>
<a name="line29"> 29: </a><font color="#B22222">   - Move FETIDP code to its own classes</font>

<a name="line31"> 31: </a><font color="#B22222">   <A href="../../../../../docs/manualpages/Mat/MATIS.html#MATIS">MATIS</A> related operations contained in BDDC code</font>
<a name="line32"> 32: </a><font color="#B22222">   - Provide general case for subassembling</font>
<a name="line33"> 33: </a><font color="#B22222">   - *** Preallocation routines in MatISGetMPIAXAIJ</font>

<a name="line35"> 35: </a><font color="#B22222">*/</font>

<a name="line37"> 37: </a><font color="#B22222">/* ----------------------------------------------------------------------------------------------------------------------------------------------</font>
<a name="line38"> 38: </a><font color="#B22222">   Implementation of BDDC preconditioner based on:</font>
<a name="line39"> 39: </a><font color="#B22222">   C. Dohrmann "An approximate BDDC preconditioner", Numerical Linear Algebra with Applications Volume 14, Issue 2, pages 149-168, March 2007</font>
<a name="line40"> 40: </a><font color="#B22222">   ---------------------------------------------------------------------------------------------------------------------------------------------- */</font>

<a name="line42"> 42: </a><font color="#A020F0">#include &lt;../src/ksp/pc/impls/bddc/bddc.h&gt; </font><font color="#B22222">/*I "petscpc.h" I*/</font><font color="#A020F0">  </font><font color="#B22222">/* includes for fortran wrappers */</font><font color="#A020F0"></font>
<a name="line43"> 43: </a><font color="#A020F0">#include &lt;../src/ksp/pc/impls/bddc/bddcprivate.h&gt;</font>
<a name="line44"> 44: </a><font color="#A020F0">#include &lt;petscblaslapack.h&gt;</font>

<a name="line46"> 46: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>
<a name="line49"> 49: </a><strong><font color="#4169E1"><a name="PCSetFromOptions_BDDC"></a><A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCSetFromOptions_BDDC(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc)</font></strong>
<a name="line50"> 50: </a>{
<a name="line51"> 51: </a>  PC_BDDC        *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line55"> 55: </a>  <A href="../../../../../docs/manualpages/Sys/PetscOptionsHead.html#PetscOptionsHead">PetscOptionsHead</A>(<font color="#666666">"BDDC options"</font>);
<a name="line56"> 56: </a>  <font color="#B22222">/* Verbose debugging */</font>
<a name="line57"> 57: </a>  <A href="../../../../../docs/manualpages/Sys/PetscOptionsInt.html#PetscOptionsInt">PetscOptionsInt</A>(<font color="#666666">"-pc_bddc_check_level"</font>,<font color="#666666">"Verbose output for <A href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</A> (intended for debug)"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;dbg_flag,&amp;pcbddc-&gt;dbg_flag,NULL);
<a name="line58"> 58: </a>  <font color="#B22222">/* Primal space cumstomization */</font>
<a name="line59"> 59: </a>  <A href="../../../../../docs/manualpages/Sys/PetscOptionsBool.html#PetscOptionsBool">PetscOptionsBool</A>(<font color="#666666">"-pc_bddc_use_local_mat_graph"</font>,<font color="#666666">"Use or not adjacency graph of local mat for interface analysis"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;use_local_adj,&amp;pcbddc-&gt;use_local_adj,NULL);
<a name="line60"> 60: </a>  <A href="../../../../../docs/manualpages/Sys/PetscOptionsBool.html#PetscOptionsBool">PetscOptionsBool</A>(<font color="#666666">"-pc_bddc_use_vertices"</font>,<font color="#666666">"Use or not corner dofs in coarse space"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;use_vertices,&amp;pcbddc-&gt;use_vertices,NULL);
<a name="line61"> 61: </a>  <A href="../../../../../docs/manualpages/Sys/PetscOptionsBool.html#PetscOptionsBool">PetscOptionsBool</A>(<font color="#666666">"-pc_bddc_use_edges"</font>,<font color="#666666">"Use or not edge constraints in coarse space"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;use_edges,&amp;pcbddc-&gt;use_edges,NULL);
<a name="line62"> 62: </a>  <A href="../../../../../docs/manualpages/Sys/PetscOptionsBool.html#PetscOptionsBool">PetscOptionsBool</A>(<font color="#666666">"-pc_bddc_use_faces"</font>,<font color="#666666">"Use or not face constraints in coarse space"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;use_faces,&amp;pcbddc-&gt;use_faces,NULL);
<a name="line63"> 63: </a>  <font color="#B22222">/* Change of basis */</font>
<a name="line64"> 64: </a>  <A href="../../../../../docs/manualpages/Sys/PetscOptionsBool.html#PetscOptionsBool">PetscOptionsBool</A>(<font color="#666666">"-pc_bddc_use_change_of_basis"</font>,<font color="#666666">"Use or not internal change of basis on local edge nodes"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;use_change_of_basis,&amp;pcbddc-&gt;use_change_of_basis,NULL);
<a name="line65"> 65: </a>  <A href="../../../../../docs/manualpages/Sys/PetscOptionsBool.html#PetscOptionsBool">PetscOptionsBool</A>(<font color="#666666">"-pc_bddc_use_change_on_faces"</font>,<font color="#666666">"Use or not internal change of basis on local face nodes"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;use_change_on_faces,&amp;pcbddc-&gt;use_change_on_faces,NULL);
<a name="line66"> 66: </a>  <font color="#4169E1">if</font> (!pcbddc-&gt;use_change_of_basis) {
<a name="line67"> 67: </a>    pcbddc-&gt;use_change_on_faces = <A href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</A>;
<a name="line68"> 68: </a>  }
<a name="line69"> 69: </a>  <font color="#B22222">/* Switch between M_2 (default) and M_3 preconditioners (as defined by C. Dohrmann in the ref. article) */</font>
<a name="line70"> 70: </a>  <A href="../../../../../docs/manualpages/Sys/PetscOptionsBool.html#PetscOptionsBool">PetscOptionsBool</A>(<font color="#666666">"-pc_bddc_switch_static"</font>,<font color="#666666">"Switch on static condensation ops around the interface preconditioner"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;switch_static,&amp;pcbddc-&gt;switch_static,NULL);
<a name="line71"> 71: </a>  <A href="../../../../../docs/manualpages/Sys/PetscOptionsInt.html#PetscOptionsInt">PetscOptionsInt</A>(<font color="#666666">"-pc_bddc_coarsening_ratio"</font>,<font color="#666666">"Set coarsening ratio used in multilevel coarsening"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;coarsening_ratio,&amp;pcbddc-&gt;coarsening_ratio,NULL);
<a name="line72"> 72: </a>  <A href="../../../../../docs/manualpages/Sys/PetscOptionsInt.html#PetscOptionsInt">PetscOptionsInt</A>(<font color="#666666">"-pc_bddc_levels"</font>,<font color="#666666">"Set maximum number of levels for multilevel"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;max_levels,&amp;pcbddc-&gt;max_levels,NULL);
<a name="line73"> 73: </a>  <A href="../../../../../docs/manualpages/Sys/PetscOptionsBool.html#PetscOptionsBool">PetscOptionsBool</A>(<font color="#666666">"-pc_bddc_use_coarse_estimates"</font>,<font color="#666666">"Use estimated eigenvalues for coarse problem"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;use_coarse_estimates,&amp;pcbddc-&gt;use_coarse_estimates,NULL);
<a name="line74"> 74: </a>  <A href="../../../../../docs/manualpages/Sys/PetscOptionsBool.html#PetscOptionsBool">PetscOptionsBool</A>(<font color="#666666">"-pc_bddc_use_deluxe_scaling"</font>,<font color="#666666">"Use deluxe scaling for BDDC"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;use_deluxe_scaling,&amp;pcbddc-&gt;use_deluxe_scaling,NULL);
<a name="line75"> 75: </a>  <A href="../../../../../docs/manualpages/Sys/PetscOptionsTail.html#PetscOptionsTail">PetscOptionsTail</A>();
<a name="line76"> 76: </a>  <font color="#4169E1">return</font>(0);
<a name="line77"> 77: </a>}
<a name="line78"> 78: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>
<a name="line81"> 81: </a><strong><font color="#4169E1"><a name="PCBDDCSetChangeOfBasisLocalMat_BDDC"></a>static <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCBDDCSetChangeOfBasisLocalMat_BDDC(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc, <A href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</A> change)</font></strong>
<a name="line82"> 82: </a>{
<a name="line83"> 83: </a>  PC_BDDC        *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line87"> 87: </a>  <A href="../../../../../docs/manualpages/Mat/MatDestroy.html#MatDestroy">MatDestroy</A>(&amp;pcbddc-&gt;user_ChangeOfBasisMatrix);
<a name="line88"> 88: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectReference.html#PetscObjectReference">PetscObjectReference</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)change);
<a name="line89"> 89: </a>  pcbddc-&gt;user_ChangeOfBasisMatrix = change;
<a name="line90"> 90: </a>  <font color="#4169E1">return</font>(0);
<a name="line91"> 91: </a>}
<a name="line94"> 94: </a><font color="#B22222">/*@</font>
<a name="line95"> 95: </a><font color="#B22222"> <A href="../../../../../docs/manualpages/PC/PCBDDCSetChangeOfBasisLocalMat.html#PCBDDCSetChangeOfBasisLocalMat">PCBDDCSetChangeOfBasisLocalMat</A> - Set user defined change of basis for local boundary dofs</font>

<a name="line97"> 97: </a><font color="#B22222">   Collective on <A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A></font>

<a name="line99"> 99: </a><font color="#B22222">   Input Parameters:</font>
<a name="line100">100: </a><font color="#B22222">+  pc - the preconditioning context</font>
<a name="line101">101: </a><font color="#B22222">-  change - the local change of basis matrix, either in local (internal + boundary) or in local boundary numbering</font>

<a name="line103">103: </a><font color="#B22222">   Level: intermediate</font>

<a name="line105">105: </a><font color="#B22222">   Notes:</font>

<a name="line107">107: </a><font color="#B22222">.seealso: <A href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</A></font>
<a name="line108">108: </a><font color="#B22222">@*/</font>
<a name="line109">109: </a><strong><font color="#4169E1"><a name="PCBDDCSetChangeOfBasisLocalMat"></a><A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> <A href="../../../../../docs/manualpages/PC/PCBDDCSetChangeOfBasisLocalMat.html#PCBDDCSetChangeOfBasisLocalMat">PCBDDCSetChangeOfBasisLocalMat</A>(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc, <A href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</A> change)</font></strong>
<a name="line110">110: </a>{

<a name="line116">116: </a>  PetscTryMethod(pc,<font color="#666666">"PCBDDCSetChangeOfBasisLocalMat_C"</font>,(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A>,<A href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</A>),(pc,change));
<a name="line117">117: </a>  <font color="#4169E1">return</font>(0);
<a name="line118">118: </a>}
<a name="line119">119: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>
<a name="line122">122: </a><strong><font color="#4169E1"><a name="PCBDDCSetPrimalVerticesLocalIS_BDDC"></a>static <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCBDDCSetPrimalVerticesLocalIS_BDDC(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc, <A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> PrimalVertices)</font></strong>
<a name="line123">123: </a>{
<a name="line124">124: </a>  PC_BDDC        *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line128">128: </a>  <A href="../../../../../docs/manualpages/IS/ISDestroy.html#ISDestroy">ISDestroy</A>(&amp;pcbddc-&gt;user_primal_vertices);
<a name="line129">129: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectReference.html#PetscObjectReference">PetscObjectReference</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)PrimalVertices);
<a name="line130">130: </a>  pcbddc-&gt;user_primal_vertices = PrimalVertices;
<a name="line131">131: </a>  <font color="#4169E1">return</font>(0);
<a name="line132">132: </a>}
<a name="line135">135: </a><font color="#B22222">/*@</font>
<a name="line136">136: </a><font color="#B22222"> <A href="../../../../../docs/manualpages/PC/PCBDDCSetPrimalVerticesLocalIS.html#PCBDDCSetPrimalVerticesLocalIS">PCBDDCSetPrimalVerticesLocalIS</A> - Set additional user defined primal vertices in <A href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</A></font>

<a name="line138">138: </a><font color="#B22222">   Not collective</font>

<a name="line140">140: </a><font color="#B22222">   Input Parameters:</font>
<a name="line141">141: </a><font color="#B22222">+  pc - the preconditioning context</font>
<a name="line142">142: </a><font color="#B22222">-  PrimalVertices - index set of primal vertices in local numbering</font>

<a name="line144">144: </a><font color="#B22222">   Level: intermediate</font>

<a name="line146">146: </a><font color="#B22222">   Notes:</font>

<a name="line148">148: </a><font color="#B22222">.seealso: <A href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</A></font>
<a name="line149">149: </a><font color="#B22222">@*/</font>
<a name="line150">150: </a><strong><font color="#4169E1"><a name="PCBDDCSetPrimalVerticesLocalIS"></a><A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> <A href="../../../../../docs/manualpages/PC/PCBDDCSetPrimalVerticesLocalIS.html#PCBDDCSetPrimalVerticesLocalIS">PCBDDCSetPrimalVerticesLocalIS</A>(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc, <A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> PrimalVertices)</font></strong>
<a name="line151">151: </a>{

<a name="line157">157: </a>  PetscTryMethod(pc,<font color="#666666">"PCBDDCSetPrimalVerticesLocalIS_C"</font>,(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A>,<A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A>),(pc,PrimalVertices));
<a name="line158">158: </a>  <font color="#4169E1">return</font>(0);
<a name="line159">159: </a>}
<a name="line160">160: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>
<a name="line163">163: </a><strong><font color="#4169E1"><a name="PCBDDCSetCoarseningRatio_BDDC"></a>static <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCBDDCSetCoarseningRatio_BDDC(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A> k)</font></strong>
<a name="line164">164: </a>{
<a name="line165">165: </a>  PC_BDDC  *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line168">168: </a>  pcbddc-&gt;coarsening_ratio = k;
<a name="line169">169: </a>  <font color="#4169E1">return</font>(0);
<a name="line170">170: </a>}

<a name="line174">174: </a><font color="#B22222">/*@</font>
<a name="line175">175: </a><font color="#B22222"> <A href="../../../../../docs/manualpages/PC/PCBDDCSetCoarseningRatio.html#PCBDDCSetCoarseningRatio">PCBDDCSetCoarseningRatio</A> - Set coarsening ratio used in multilevel</font>

<a name="line177">177: </a><font color="#B22222">   Logically collective on <A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A></font>

<a name="line179">179: </a><font color="#B22222">   Input Parameters:</font>
<a name="line180">180: </a><font color="#B22222">+  pc - the preconditioning context</font>
<a name="line181">181: </a><font color="#B22222">-  k - coarsening ratio (H/h at the coarser level)</font>

<a name="line183">183: </a><font color="#B22222">   Approximatively k subdomains at the finer level will be aggregated into a single subdomain at the coarser level</font>

<a name="line185">185: </a><font color="#B22222">   Level: intermediate</font>

<a name="line187">187: </a><font color="#B22222">   Notes:</font>

<a name="line189">189: </a><font color="#B22222">.seealso: <A href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</A></font>
<a name="line190">190: </a><font color="#B22222">@*/</font>
<a name="line191">191: </a><strong><font color="#4169E1"><a name="PCBDDCSetCoarseningRatio"></a><A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> <A href="../../../../../docs/manualpages/PC/PCBDDCSetCoarseningRatio.html#PCBDDCSetCoarseningRatio">PCBDDCSetCoarseningRatio</A>(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A> k)</font></strong>
<a name="line192">192: </a>{

<a name="line198">198: </a>  PetscTryMethod(pc,<font color="#666666">"PCBDDCSetCoarseningRatio_C"</font>,(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A>,<A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A>),(pc,k));
<a name="line199">199: </a>  <font color="#4169E1">return</font>(0);
<a name="line200">200: </a>}

<a name="line202">202: </a><font color="#B22222">/* The following functions (PCBDDCSetUseExactDirichlet PCBDDCSetLevel) are not public */</font>
<a name="line205">205: </a><strong><font color="#4169E1"><a name="PCBDDCSetUseExactDirichlet_BDDC"></a>static <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCBDDCSetUseExactDirichlet_BDDC(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</A> flg)</font></strong>
<a name="line206">206: </a>{
<a name="line207">207: </a>  PC_BDDC  *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line210">210: </a>  pcbddc-&gt;use_exact_dirichlet_trick = flg;
<a name="line211">211: </a>  <font color="#4169E1">return</font>(0);
<a name="line212">212: </a>}

<a name="line216">216: </a><strong><font color="#4169E1"><a name="PCBDDCSetUseExactDirichlet"></a><A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCBDDCSetUseExactDirichlet(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</A> flg)</font></strong>
<a name="line217">217: </a>{

<a name="line223">223: </a>  PetscTryMethod(pc,<font color="#666666">"PCBDDCSetUseExactDirichlet_C"</font>,(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A>,<A href="../../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</A>),(pc,flg));
<a name="line224">224: </a>  <font color="#4169E1">return</font>(0);
<a name="line225">225: </a>}

<a name="line229">229: </a><strong><font color="#4169E1"><a name="PCBDDCSetLevel_BDDC"></a>static <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCBDDCSetLevel_BDDC(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A> level)</font></strong>
<a name="line230">230: </a>{
<a name="line231">231: </a>  PC_BDDC  *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line234">234: </a>  pcbddc-&gt;current_level = level;
<a name="line235">235: </a>  <font color="#4169E1">return</font>(0);
<a name="line236">236: </a>}

<a name="line240">240: </a><strong><font color="#4169E1"><a name="PCBDDCSetLevel"></a><A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCBDDCSetLevel(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A> level)</font></strong>
<a name="line241">241: </a>{

<a name="line247">247: </a>  PetscTryMethod(pc,<font color="#666666">"PCBDDCSetLevel_C"</font>,(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A>,<A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A>),(pc,level));
<a name="line248">248: </a>  <font color="#4169E1">return</font>(0);
<a name="line249">249: </a>}

<a name="line253">253: </a><strong><font color="#4169E1"><a name="PCBDDCSetLevels_BDDC"></a>static <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCBDDCSetLevels_BDDC(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A> levels)</font></strong>
<a name="line254">254: </a>{
<a name="line255">255: </a>  PC_BDDC  *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line258">258: </a>  pcbddc-&gt;max_levels = levels;
<a name="line259">259: </a>  <font color="#4169E1">return</font>(0);
<a name="line260">260: </a>}

<a name="line264">264: </a><font color="#B22222">/*@</font>
<a name="line265">265: </a><font color="#B22222"> <A href="../../../../../docs/manualpages/PC/PCBDDCSetLevels.html#PCBDDCSetLevels">PCBDDCSetLevels</A> - Sets the maximum number of levels for multilevel</font>

<a name="line267">267: </a><font color="#B22222">   Logically collective on <A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A></font>

<a name="line269">269: </a><font color="#B22222">   Input Parameters:</font>
<a name="line270">270: </a><font color="#B22222">+  pc - the preconditioning context</font>
<a name="line271">271: </a><font color="#B22222">-  levels - the maximum number of levels (max 9)</font>

<a name="line273">273: </a><font color="#B22222">   Default value is 0, i.e. traditional one-level BDDC</font>

<a name="line275">275: </a><font color="#B22222">   Level: intermediate</font>

<a name="line277">277: </a><font color="#B22222">   Notes:</font>

<a name="line279">279: </a><font color="#B22222">.seealso: <A href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</A></font>
<a name="line280">280: </a><font color="#B22222">@*/</font>
<a name="line281">281: </a><strong><font color="#4169E1"><a name="PCBDDCSetLevels"></a><A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> <A href="../../../../../docs/manualpages/PC/PCBDDCSetLevels.html#PCBDDCSetLevels">PCBDDCSetLevels</A>(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A> levels)</font></strong>
<a name="line282">282: </a>{

<a name="line288">288: </a>  <font color="#4169E1">if</font> (levels &gt; 99) <A href="../../../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</A>(<A href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc),PETSC_ERR_SUP,<font color="#666666">"Maximum number of levels for bddc is 99\n"</font>);
<a name="line289">289: </a>  PetscTryMethod(pc,<font color="#666666">"PCBDDCSetLevels_C"</font>,(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A>,<A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A>),(pc,levels));
<a name="line290">290: </a>  <font color="#4169E1">return</font>(0);
<a name="line291">291: </a>}
<a name="line292">292: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line296">296: </a><strong><font color="#4169E1"><a name="PCBDDCSetNullSpace_BDDC"></a>static <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCBDDCSetNullSpace_BDDC(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/Mat/MatNullSpace.html#MatNullSpace">MatNullSpace</A> NullSpace)</font></strong>
<a name="line297">297: </a>{
<a name="line298">298: </a>  PC_BDDC  *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line302">302: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectReference.html#PetscObjectReference">PetscObjectReference</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)NullSpace);
<a name="line303">303: </a>  <A href="../../../../../docs/manualpages/Mat/MatNullSpaceDestroy.html#MatNullSpaceDestroy">MatNullSpaceDestroy</A>(&amp;pcbddc-&gt;NullSpace);
<a name="line304">304: </a>  pcbddc-&gt;NullSpace = NullSpace;
<a name="line305">305: </a>  <font color="#4169E1">return</font>(0);
<a name="line306">306: </a>}

<a name="line310">310: </a><font color="#B22222">/*@</font>
<a name="line311">311: </a><font color="#B22222"> <A href="../../../../../docs/manualpages/PC/PCBDDCSetNullSpace.html#PCBDDCSetNullSpace">PCBDDCSetNullSpace</A> - Set nullspace for BDDC operator</font>

<a name="line313">313: </a><font color="#B22222">   Logically collective on <A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> and <A href="../../../../../docs/manualpages/Mat/MatNullSpace.html#MatNullSpace">MatNullSpace</A></font>

<a name="line315">315: </a><font color="#B22222">   Input Parameters:</font>
<a name="line316">316: </a><font color="#B22222">+  pc - the preconditioning context</font>
<a name="line317">317: </a><font color="#B22222">-  NullSpace - Null space of the linear operator to be preconditioned (Pmat)</font>

<a name="line319">319: </a><font color="#B22222">   Level: intermediate</font>

<a name="line321">321: </a><font color="#B22222">   Notes:</font>

<a name="line323">323: </a><font color="#B22222">.seealso: <A href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</A></font>
<a name="line324">324: </a><font color="#B22222">@*/</font>
<a name="line325">325: </a><strong><font color="#4169E1"><a name="PCBDDCSetNullSpace"></a><A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> <A href="../../../../../docs/manualpages/PC/PCBDDCSetNullSpace.html#PCBDDCSetNullSpace">PCBDDCSetNullSpace</A>(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/Mat/MatNullSpace.html#MatNullSpace">MatNullSpace</A> NullSpace)</font></strong>
<a name="line326">326: </a>{

<a name="line333">333: </a>  PetscTryMethod(pc,<font color="#666666">"PCBDDCSetNullSpace_C"</font>,(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A>,<A href="../../../../../docs/manualpages/Mat/MatNullSpace.html#MatNullSpace">MatNullSpace</A>),(pc,NullSpace));
<a name="line334">334: </a>  <font color="#4169E1">return</font>(0);
<a name="line335">335: </a>}
<a name="line336">336: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line340">340: </a><strong><font color="#4169E1"><a name="PCBDDCSetDirichletBoundaries_BDDC"></a>static <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCBDDCSetDirichletBoundaries_BDDC(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> DirichletBoundaries)</font></strong>
<a name="line341">341: </a>{
<a name="line342">342: </a>  PC_BDDC  *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line346">346: </a>  <font color="#B22222">/* last user setting takes precendence -&gt; destroy any other customization */</font>
<a name="line347">347: </a>  <A href="../../../../../docs/manualpages/IS/ISDestroy.html#ISDestroy">ISDestroy</A>(&amp;pcbddc-&gt;DirichletBoundariesLocal);
<a name="line348">348: </a>  <A href="../../../../../docs/manualpages/IS/ISDestroy.html#ISDestroy">ISDestroy</A>(&amp;pcbddc-&gt;DirichletBoundaries);
<a name="line349">349: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectReference.html#PetscObjectReference">PetscObjectReference</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)DirichletBoundaries);
<a name="line350">350: </a>  pcbddc-&gt;DirichletBoundaries = DirichletBoundaries;
<a name="line351">351: </a>  pcbddc-&gt;recompute_topography = <A href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</A>;
<a name="line352">352: </a>  <font color="#4169E1">return</font>(0);
<a name="line353">353: </a>}

<a name="line357">357: </a><font color="#B22222">/*@</font>
<a name="line358">358: </a><font color="#B22222"> <A href="../../../../../docs/manualpages/PC/PCBDDCSetDirichletBoundaries.html#PCBDDCSetDirichletBoundaries">PCBDDCSetDirichletBoundaries</A> - Set <A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> defining Dirichlet boundaries for the global problem.</font>

<a name="line360">360: </a><font color="#B22222">   Collective</font>

<a name="line362">362: </a><font color="#B22222">   Input Parameters:</font>
<a name="line363">363: </a><font color="#B22222">+  pc - the preconditioning context</font>
<a name="line364">364: </a><font color="#B22222">-  DirichletBoundaries - parallel <A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> defining the Dirichlet boundaries</font>

<a name="line366">366: </a><font color="#B22222">   Level: intermediate</font>

<a name="line368">368: </a><font color="#B22222">   Notes: Any process can list any global node</font>

<a name="line370">370: </a><font color="#B22222">.seealso: <A href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</A></font>
<a name="line371">371: </a><font color="#B22222">@*/</font>
<a name="line372">372: </a><strong><font color="#4169E1"><a name="PCBDDCSetDirichletBoundaries"></a><A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> <A href="../../../../../docs/manualpages/PC/PCBDDCSetDirichletBoundaries.html#PCBDDCSetDirichletBoundaries">PCBDDCSetDirichletBoundaries</A>(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> DirichletBoundaries)</font></strong>
<a name="line373">373: </a>{

<a name="line380">380: </a>  PetscTryMethod(pc,<font color="#666666">"PCBDDCSetDirichletBoundaries_C"</font>,(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A>,<A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A>),(pc,DirichletBoundaries));
<a name="line381">381: </a>  <font color="#4169E1">return</font>(0);
<a name="line382">382: </a>}
<a name="line383">383: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line387">387: </a><strong><font color="#4169E1"><a name="PCBDDCSetDirichletBoundariesLocal_BDDC"></a>static <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCBDDCSetDirichletBoundariesLocal_BDDC(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> DirichletBoundaries)</font></strong>
<a name="line388">388: </a>{
<a name="line389">389: </a>  PC_BDDC  *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line393">393: </a>  <font color="#B22222">/* last user setting takes precendence -&gt; destroy any other customization */</font>
<a name="line394">394: </a>  <A href="../../../../../docs/manualpages/IS/ISDestroy.html#ISDestroy">ISDestroy</A>(&amp;pcbddc-&gt;DirichletBoundariesLocal);
<a name="line395">395: </a>  <A href="../../../../../docs/manualpages/IS/ISDestroy.html#ISDestroy">ISDestroy</A>(&amp;pcbddc-&gt;DirichletBoundaries);
<a name="line396">396: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectReference.html#PetscObjectReference">PetscObjectReference</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)DirichletBoundaries);
<a name="line397">397: </a>  pcbddc-&gt;DirichletBoundariesLocal = DirichletBoundaries;
<a name="line398">398: </a>  pcbddc-&gt;recompute_topography = <A href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</A>;
<a name="line399">399: </a>  <font color="#4169E1">return</font>(0);
<a name="line400">400: </a>}

<a name="line404">404: </a><font color="#B22222">/*@</font>
<a name="line405">405: </a><font color="#B22222"> <A href="../../../../../docs/manualpages/PC/PCBDDCSetDirichletBoundariesLocal.html#PCBDDCSetDirichletBoundariesLocal">PCBDDCSetDirichletBoundariesLocal</A> - Set <A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> defining Dirichlet boundaries for the global problem in local ordering.</font>

<a name="line407">407: </a><font color="#B22222">   Collective</font>

<a name="line409">409: </a><font color="#B22222">   Input Parameters:</font>
<a name="line410">410: </a><font color="#B22222">+  pc - the preconditioning context</font>
<a name="line411">411: </a><font color="#B22222">-  DirichletBoundaries - parallel <A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> defining the Dirichlet boundaries (in local ordering)</font>

<a name="line413">413: </a><font color="#B22222">   Level: intermediate</font>

<a name="line415">415: </a><font color="#B22222">   Notes:</font>

<a name="line417">417: </a><font color="#B22222">.seealso: <A href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</A></font>
<a name="line418">418: </a><font color="#B22222">@*/</font>
<a name="line419">419: </a><strong><font color="#4169E1"><a name="PCBDDCSetDirichletBoundariesLocal"></a><A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> <A href="../../../../../docs/manualpages/PC/PCBDDCSetDirichletBoundariesLocal.html#PCBDDCSetDirichletBoundariesLocal">PCBDDCSetDirichletBoundariesLocal</A>(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> DirichletBoundaries)</font></strong>
<a name="line420">420: </a>{

<a name="line427">427: </a>  PetscTryMethod(pc,<font color="#666666">"PCBDDCSetDirichletBoundariesLocal_C"</font>,(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A>,<A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A>),(pc,DirichletBoundaries));
<a name="line428">428: </a>  <font color="#4169E1">return</font>(0);
<a name="line429">429: </a>}
<a name="line430">430: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line434">434: </a><strong><font color="#4169E1"><a name="PCBDDCSetNeumannBoundaries_BDDC"></a>static <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCBDDCSetNeumannBoundaries_BDDC(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> NeumannBoundaries)</font></strong>
<a name="line435">435: </a>{
<a name="line436">436: </a>  PC_BDDC  *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line440">440: </a>  <font color="#B22222">/* last user setting takes precendence -&gt; destroy any other customization */</font>
<a name="line441">441: </a>  <A href="../../../../../docs/manualpages/IS/ISDestroy.html#ISDestroy">ISDestroy</A>(&amp;pcbddc-&gt;NeumannBoundariesLocal);
<a name="line442">442: </a>  <A href="../../../../../docs/manualpages/IS/ISDestroy.html#ISDestroy">ISDestroy</A>(&amp;pcbddc-&gt;NeumannBoundaries);
<a name="line443">443: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectReference.html#PetscObjectReference">PetscObjectReference</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)NeumannBoundaries);
<a name="line444">444: </a>  pcbddc-&gt;NeumannBoundaries = NeumannBoundaries;
<a name="line445">445: </a>  pcbddc-&gt;recompute_topography = <A href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</A>;
<a name="line446">446: </a>  <font color="#4169E1">return</font>(0);
<a name="line447">447: </a>}

<a name="line451">451: </a><font color="#B22222">/*@</font>
<a name="line452">452: </a><font color="#B22222"> <A href="../../../../../docs/manualpages/PC/PCBDDCSetNeumannBoundaries.html#PCBDDCSetNeumannBoundaries">PCBDDCSetNeumannBoundaries</A> - Set <A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> defining Neumann boundaries for the global problem.</font>

<a name="line454">454: </a><font color="#B22222">   Collective</font>

<a name="line456">456: </a><font color="#B22222">   Input Parameters:</font>
<a name="line457">457: </a><font color="#B22222">+  pc - the preconditioning context</font>
<a name="line458">458: </a><font color="#B22222">-  NeumannBoundaries - parallel <A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> defining the Neumann boundaries</font>

<a name="line460">460: </a><font color="#B22222">   Level: intermediate</font>

<a name="line462">462: </a><font color="#B22222">   Notes: Any process can list any global node</font>

<a name="line464">464: </a><font color="#B22222">.seealso: <A href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</A></font>
<a name="line465">465: </a><font color="#B22222">@*/</font>
<a name="line466">466: </a><strong><font color="#4169E1"><a name="PCBDDCSetNeumannBoundaries"></a><A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> <A href="../../../../../docs/manualpages/PC/PCBDDCSetNeumannBoundaries.html#PCBDDCSetNeumannBoundaries">PCBDDCSetNeumannBoundaries</A>(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> NeumannBoundaries)</font></strong>
<a name="line467">467: </a>{

<a name="line474">474: </a>  PetscTryMethod(pc,<font color="#666666">"PCBDDCSetNeumannBoundaries_C"</font>,(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A>,<A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A>),(pc,NeumannBoundaries));
<a name="line475">475: </a>  <font color="#4169E1">return</font>(0);
<a name="line476">476: </a>}
<a name="line477">477: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line481">481: </a><strong><font color="#4169E1"><a name="PCBDDCSetNeumannBoundariesLocal_BDDC"></a>static <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCBDDCSetNeumannBoundariesLocal_BDDC(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> NeumannBoundaries)</font></strong>
<a name="line482">482: </a>{
<a name="line483">483: </a>  PC_BDDC  *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line487">487: </a>  <font color="#B22222">/* last user setting takes precendence -&gt; destroy any other customization */</font>
<a name="line488">488: </a>  <A href="../../../../../docs/manualpages/IS/ISDestroy.html#ISDestroy">ISDestroy</A>(&amp;pcbddc-&gt;NeumannBoundariesLocal);
<a name="line489">489: </a>  <A href="../../../../../docs/manualpages/IS/ISDestroy.html#ISDestroy">ISDestroy</A>(&amp;pcbddc-&gt;NeumannBoundaries);
<a name="line490">490: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectReference.html#PetscObjectReference">PetscObjectReference</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)NeumannBoundaries);
<a name="line491">491: </a>  pcbddc-&gt;NeumannBoundariesLocal = NeumannBoundaries;
<a name="line492">492: </a>  pcbddc-&gt;recompute_topography = <A href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</A>;
<a name="line493">493: </a>  <font color="#4169E1">return</font>(0);
<a name="line494">494: </a>}

<a name="line498">498: </a><font color="#B22222">/*@</font>
<a name="line499">499: </a><font color="#B22222"> <A href="../../../../../docs/manualpages/PC/PCBDDCSetNeumannBoundariesLocal.html#PCBDDCSetNeumannBoundariesLocal">PCBDDCSetNeumannBoundariesLocal</A> - Set <A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> defining Neumann boundaries for the global problem in local ordering.</font>

<a name="line501">501: </a><font color="#B22222">   Collective</font>

<a name="line503">503: </a><font color="#B22222">   Input Parameters:</font>
<a name="line504">504: </a><font color="#B22222">+  pc - the preconditioning context</font>
<a name="line505">505: </a><font color="#B22222">-  NeumannBoundaries - parallel <A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> defining the subdomain part of Neumann boundaries (in local ordering)</font>

<a name="line507">507: </a><font color="#B22222">   Level: intermediate</font>

<a name="line509">509: </a><font color="#B22222">   Notes:</font>

<a name="line511">511: </a><font color="#B22222">.seealso: <A href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</A></font>
<a name="line512">512: </a><font color="#B22222">@*/</font>
<a name="line513">513: </a><strong><font color="#4169E1"><a name="PCBDDCSetNeumannBoundariesLocal"></a><A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> <A href="../../../../../docs/manualpages/PC/PCBDDCSetNeumannBoundariesLocal.html#PCBDDCSetNeumannBoundariesLocal">PCBDDCSetNeumannBoundariesLocal</A>(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> NeumannBoundaries)</font></strong>
<a name="line514">514: </a>{

<a name="line521">521: </a>  PetscTryMethod(pc,<font color="#666666">"PCBDDCSetNeumannBoundariesLocal_C"</font>,(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A>,<A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A>),(pc,NeumannBoundaries));
<a name="line522">522: </a>  <font color="#4169E1">return</font>(0);
<a name="line523">523: </a>}
<a name="line524">524: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line528">528: </a><strong><font color="#4169E1"><a name="PCBDDCGetDirichletBoundaries_BDDC"></a>static <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCBDDCGetDirichletBoundaries_BDDC(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> *DirichletBoundaries)</font></strong>
<a name="line529">529: </a>{
<a name="line530">530: </a>  PC_BDDC  *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line533">533: </a>  *DirichletBoundaries = pcbddc-&gt;DirichletBoundaries;
<a name="line534">534: </a>  <font color="#4169E1">return</font>(0);
<a name="line535">535: </a>}

<a name="line539">539: </a><font color="#B22222">/*@</font>
<a name="line540">540: </a><font color="#B22222"> <A href="../../../../../docs/manualpages/PC/PCBDDCGetDirichletBoundaries.html#PCBDDCGetDirichletBoundaries">PCBDDCGetDirichletBoundaries</A> - Get parallel <A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> for Dirichlet boundaries</font>

<a name="line542">542: </a><font color="#B22222">   Collective</font>

<a name="line544">544: </a><font color="#B22222">   Input Parameters:</font>
<a name="line545">545: </a><font color="#B22222">.  pc - the preconditioning context</font>

<a name="line547">547: </a><font color="#B22222">   Output Parameters:</font>
<a name="line548">548: </a><font color="#B22222">.  DirichletBoundaries - index set defining the Dirichlet boundaries</font>

<a name="line550">550: </a><font color="#B22222">   Level: intermediate</font>

<a name="line552">552: </a><font color="#B22222">   Notes: The <A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> returned (if any) is the same passed in earlier by the user with <A href="../../../../../docs/manualpages/PC/PCBDDCSetDirichletBoundaries.html#PCBDDCSetDirichletBoundaries">PCBDDCSetDirichletBoundaries</A></font>

<a name="line554">554: </a><font color="#B22222">.seealso: <A href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</A></font>
<a name="line555">555: </a><font color="#B22222">@*/</font>
<a name="line556">556: </a><strong><font color="#4169E1"><a name="PCBDDCGetDirichletBoundaries"></a><A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> <A href="../../../../../docs/manualpages/PC/PCBDDCGetDirichletBoundaries.html#PCBDDCGetDirichletBoundaries">PCBDDCGetDirichletBoundaries</A>(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> *DirichletBoundaries)</font></strong>
<a name="line557">557: </a>{

<a name="line562">562: </a>  PetscUseMethod(pc,<font color="#666666">"PCBDDCGetDirichletBoundaries_C"</font>,(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A>,<A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A>*),(pc,DirichletBoundaries));
<a name="line563">563: </a>  <font color="#4169E1">return</font>(0);
<a name="line564">564: </a>}
<a name="line565">565: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line569">569: </a><strong><font color="#4169E1"><a name="PCBDDCGetDirichletBoundariesLocal_BDDC"></a>static <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCBDDCGetDirichletBoundariesLocal_BDDC(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> *DirichletBoundaries)</font></strong>
<a name="line570">570: </a>{
<a name="line571">571: </a>  PC_BDDC  *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line574">574: </a>  *DirichletBoundaries = pcbddc-&gt;DirichletBoundariesLocal;
<a name="line575">575: </a>  <font color="#4169E1">return</font>(0);
<a name="line576">576: </a>}

<a name="line580">580: </a><font color="#B22222">/*@</font>
<a name="line581">581: </a><font color="#B22222"> <A href="../../../../../docs/manualpages/PC/PCBDDCGetDirichletBoundariesLocal.html#PCBDDCGetDirichletBoundariesLocal">PCBDDCGetDirichletBoundariesLocal</A> - Get parallel <A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> for Dirichlet boundaries (in local ordering)</font>

<a name="line583">583: </a><font color="#B22222">   Collective</font>

<a name="line585">585: </a><font color="#B22222">   Input Parameters:</font>
<a name="line586">586: </a><font color="#B22222">.  pc - the preconditioning context</font>

<a name="line588">588: </a><font color="#B22222">   Output Parameters:</font>
<a name="line589">589: </a><font color="#B22222">.  DirichletBoundaries - index set defining the subdomain part of Dirichlet boundaries</font>

<a name="line591">591: </a><font color="#B22222">   Level: intermediate</font>

<a name="line593">593: </a><font color="#B22222">   Notes:</font>

<a name="line595">595: </a><font color="#B22222">.seealso: <A href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</A></font>
<a name="line596">596: </a><font color="#B22222">@*/</font>
<a name="line597">597: </a><strong><font color="#4169E1"><a name="PCBDDCGetDirichletBoundariesLocal"></a><A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> <A href="../../../../../docs/manualpages/PC/PCBDDCGetDirichletBoundariesLocal.html#PCBDDCGetDirichletBoundariesLocal">PCBDDCGetDirichletBoundariesLocal</A>(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> *DirichletBoundaries)</font></strong>
<a name="line598">598: </a>{

<a name="line603">603: </a>  PetscUseMethod(pc,<font color="#666666">"PCBDDCGetDirichletBoundariesLocal_C"</font>,(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A>,<A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A>*),(pc,DirichletBoundaries));
<a name="line604">604: </a>  <font color="#4169E1">return</font>(0);
<a name="line605">605: </a>}
<a name="line606">606: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line610">610: </a><strong><font color="#4169E1"><a name="PCBDDCGetNeumannBoundaries_BDDC"></a>static <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCBDDCGetNeumannBoundaries_BDDC(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> *NeumannBoundaries)</font></strong>
<a name="line611">611: </a>{
<a name="line612">612: </a>  PC_BDDC  *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line615">615: </a>  *NeumannBoundaries = pcbddc-&gt;NeumannBoundaries;
<a name="line616">616: </a>  <font color="#4169E1">return</font>(0);
<a name="line617">617: </a>}

<a name="line621">621: </a><font color="#B22222">/*@</font>
<a name="line622">622: </a><font color="#B22222"> <A href="../../../../../docs/manualpages/PC/PCBDDCGetNeumannBoundaries.html#PCBDDCGetNeumannBoundaries">PCBDDCGetNeumannBoundaries</A> - Get parallel <A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> for Neumann boundaries</font>

<a name="line624">624: </a><font color="#B22222">   Collective</font>

<a name="line626">626: </a><font color="#B22222">   Input Parameters:</font>
<a name="line627">627: </a><font color="#B22222">.  pc - the preconditioning context</font>

<a name="line629">629: </a><font color="#B22222">   Output Parameters:</font>
<a name="line630">630: </a><font color="#B22222">.  NeumannBoundaries - index set defining the Neumann boundaries</font>

<a name="line632">632: </a><font color="#B22222">   Level: intermediate</font>

<a name="line634">634: </a><font color="#B22222">   Notes: The <A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> returned (if any) is the same passed in earlier by the user with <A href="../../../../../docs/manualpages/PC/PCBDDCSetNeumannBoundaries.html#PCBDDCSetNeumannBoundaries">PCBDDCSetNeumannBoundaries</A></font>

<a name="line636">636: </a><font color="#B22222">.seealso: <A href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</A></font>
<a name="line637">637: </a><font color="#B22222">@*/</font>
<a name="line638">638: </a><strong><font color="#4169E1"><a name="PCBDDCGetNeumannBoundaries"></a><A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> <A href="../../../../../docs/manualpages/PC/PCBDDCGetNeumannBoundaries.html#PCBDDCGetNeumannBoundaries">PCBDDCGetNeumannBoundaries</A>(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> *NeumannBoundaries)</font></strong>
<a name="line639">639: </a>{

<a name="line644">644: </a>  PetscUseMethod(pc,<font color="#666666">"PCBDDCGetNeumannBoundaries_C"</font>,(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A>,<A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A>*),(pc,NeumannBoundaries));
<a name="line645">645: </a>  <font color="#4169E1">return</font>(0);
<a name="line646">646: </a>}
<a name="line647">647: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line651">651: </a><strong><font color="#4169E1"><a name="PCBDDCGetNeumannBoundariesLocal_BDDC"></a>static <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCBDDCGetNeumannBoundariesLocal_BDDC(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> *NeumannBoundaries)</font></strong>
<a name="line652">652: </a>{
<a name="line653">653: </a>  PC_BDDC  *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line656">656: </a>  *NeumannBoundaries = pcbddc-&gt;NeumannBoundariesLocal;
<a name="line657">657: </a>  <font color="#4169E1">return</font>(0);
<a name="line658">658: </a>}

<a name="line662">662: </a><font color="#B22222">/*@</font>
<a name="line663">663: </a><font color="#B22222"> <A href="../../../../../docs/manualpages/PC/PCBDDCGetNeumannBoundariesLocal.html#PCBDDCGetNeumannBoundariesLocal">PCBDDCGetNeumannBoundariesLocal</A> - Get parallel <A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> for Neumann boundaries (in local ordering)</font>

<a name="line665">665: </a><font color="#B22222">   Collective</font>

<a name="line667">667: </a><font color="#B22222">   Input Parameters:</font>
<a name="line668">668: </a><font color="#B22222">.  pc - the preconditioning context</font>

<a name="line670">670: </a><font color="#B22222">   Output Parameters:</font>
<a name="line671">671: </a><font color="#B22222">.  NeumannBoundaries - index set defining the subdomain part of Neumann boundaries</font>

<a name="line673">673: </a><font color="#B22222">   Level: intermediate</font>

<a name="line675">675: </a><font color="#B22222">   Notes:</font>

<a name="line677">677: </a><font color="#B22222">.seealso: <A href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</A></font>
<a name="line678">678: </a><font color="#B22222">@*/</font>
<a name="line679">679: </a><strong><font color="#4169E1"><a name="PCBDDCGetNeumannBoundariesLocal"></a><A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> <A href="../../../../../docs/manualpages/PC/PCBDDCGetNeumannBoundariesLocal.html#PCBDDCGetNeumannBoundariesLocal">PCBDDCGetNeumannBoundariesLocal</A>(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> *NeumannBoundaries)</font></strong>
<a name="line680">680: </a>{

<a name="line685">685: </a>  PetscUseMethod(pc,<font color="#666666">"PCBDDCGetNeumannBoundariesLocal_C"</font>,(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A>,<A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A>*),(pc,NeumannBoundaries));
<a name="line686">686: </a>  <font color="#4169E1">return</font>(0);
<a name="line687">687: </a>}
<a name="line688">688: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line692">692: </a><strong><font color="#4169E1"><a name="PCBDDCSetLocalAdjacencyGraph_BDDC"></a>static <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCBDDCSetLocalAdjacencyGraph_BDDC(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc, <A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A> nvtxs,const <A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A> xadj[],const <A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A> adjncy[], <A href="../../../../../docs/manualpages/Sys/PetscCopyMode.html#PetscCopyMode">PetscCopyMode</A> copymode)</font></strong>
<a name="line693">693: </a>{
<a name="line694">694: </a>  PC_BDDC        *pcbddc = (PC_BDDC*)pc-&gt;data;
<a name="line695">695: </a>  PCBDDCGraph    mat_graph = pcbddc-&gt;mat_graph;

<a name="line699">699: </a>  <font color="#B22222">/* free old CSR */</font>
<a name="line700">700: </a>  PCBDDCGraphResetCSR(mat_graph);
<a name="line701">701: </a>  <font color="#B22222">/* TODO: PCBDDCGraphSetAdjacency */</font>
<a name="line702">702: </a>  <font color="#B22222">/* get CSR into graph structure */</font>
<a name="line703">703: </a>  <font color="#4169E1">if</font> (copymode == PETSC_COPY_VALUES) {
<a name="line704">704: </a>    <A href="../../../../../docs/manualpages/Sys/PetscMalloc1.html#PetscMalloc1">PetscMalloc1</A>((nvtxs+1),&amp;mat_graph-&gt;xadj);
<a name="line705">705: </a>    <A href="../../../../../docs/manualpages/Sys/PetscMalloc1.html#PetscMalloc1">PetscMalloc1</A>(xadj[nvtxs],&amp;mat_graph-&gt;adjncy);
<a name="line706">706: </a>    <A href="../../../../../docs/manualpages/Sys/PetscMemcpy.html#PetscMemcpy">PetscMemcpy</A>(mat_graph-&gt;xadj,xadj,(nvtxs+1)*<font color="#4169E1">sizeof</font>(<A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A>));
<a name="line707">707: </a>    <A href="../../../../../docs/manualpages/Sys/PetscMemcpy.html#PetscMemcpy">PetscMemcpy</A>(mat_graph-&gt;adjncy,adjncy,xadj[nvtxs]*<font color="#4169E1">sizeof</font>(<A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A>));
<a name="line708">708: </a>  } <font color="#4169E1">else</font> <font color="#4169E1">if</font> (copymode == PETSC_OWN_POINTER) {
<a name="line709">709: </a>    mat_graph-&gt;xadj = (<A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A>*)xadj;
<a name="line710">710: </a>    mat_graph-&gt;adjncy = (<A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A>*)adjncy;
<a name="line711">711: </a>  }
<a name="line712">712: </a>  mat_graph-&gt;nvtxs_csr = nvtxs;
<a name="line713">713: </a>  <font color="#4169E1">return</font>(0);
<a name="line714">714: </a>}

<a name="line718">718: </a><font color="#B22222">/*@</font>
<a name="line719">719: </a><font color="#B22222"> <A href="../../../../../docs/manualpages/PC/PCBDDCSetLocalAdjacencyGraph.html#PCBDDCSetLocalAdjacencyGraph">PCBDDCSetLocalAdjacencyGraph</A> - Set adjacency structure (CSR graph) of the local Neumann matrix</font>

<a name="line721">721: </a><font color="#B22222">   Not collective</font>

<a name="line723">723: </a><font color="#B22222">   Input Parameters:</font>
<a name="line724">724: </a><font color="#B22222">+  pc - the preconditioning context</font>
<a name="line725">725: </a><font color="#B22222">.  nvtxs - number of local vertices of the graph (i.e., the local size of your problem)</font>
<a name="line726">726: </a><font color="#B22222">.  xadj, adjncy - the CSR graph</font>
<a name="line727">727: </a><font color="#B22222">-  copymode - either PETSC_COPY_VALUES or PETSC_OWN_POINTER.</font>

<a name="line729">729: </a><font color="#B22222">   Level: intermediate</font>

<a name="line731">731: </a><font color="#B22222">   Notes:</font>

<a name="line733">733: </a><font color="#B22222">.seealso: <A href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</A>,<A href="../../../../../docs/manualpages/Sys/PetscCopyMode.html#PetscCopyMode">PetscCopyMode</A></font>
<a name="line734">734: </a><font color="#B22222">@*/</font>
<a name="line735">735: </a><strong><font color="#4169E1"><a name="PCBDDCSetLocalAdjacencyGraph"></a><A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> <A href="../../../../../docs/manualpages/PC/PCBDDCSetLocalAdjacencyGraph.html#PCBDDCSetLocalAdjacencyGraph">PCBDDCSetLocalAdjacencyGraph</A>(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A> nvtxs,const <A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A> xadj[],const <A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A> adjncy[], <A href="../../../../../docs/manualpages/Sys/PetscCopyMode.html#PetscCopyMode">PetscCopyMode</A> copymode)</font></strong>
<a name="line736">736: </a>{
<a name="line737">737: </a>  void (*f)(void) = 0;

<a name="line744">744: </a>  <font color="#4169E1">if</font> (copymode != PETSC_COPY_VALUES &amp;&amp; copymode != PETSC_OWN_POINTER) {
<a name="line745">745: </a>    <A href="../../../../../docs/manualpages/Sys/SETERRQ2.html#SETERRQ2">SETERRQ2</A>(<A href="../../../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</A>,PETSC_ERR_SUP,<font color="#666666">"Unsupported copy mode %d in %s\n"</font>,copymode,__FUNCT__);
<a name="line746">746: </a>  }
<a name="line747">747: </a>  PetscTryMethod(pc,<font color="#666666">"PCBDDCSetLocalAdjacencyGraph_C"</font>,(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A>,<A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A>,const <A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A>[],const <A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A>[],<A href="../../../../../docs/manualpages/Sys/PetscCopyMode.html#PetscCopyMode">PetscCopyMode</A>),(pc,nvtxs,xadj,adjncy,copymode));
<a name="line748">748: </a>  <font color="#B22222">/* free arrays if <A href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</A> is not the <A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> type */</font>
<a name="line749">749: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectQueryFunction.html#PetscObjectQueryFunction">PetscObjectQueryFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCSetLocalAdjacencyGraph_C"</font>,&amp;f);
<a name="line750">750: </a>  <font color="#4169E1">if</font> (!f &amp;&amp; copymode == PETSC_OWN_POINTER) {
<a name="line751">751: </a>    <A href="../../../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</A>(xadj);
<a name="line752">752: </a>    <A href="../../../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</A>(adjncy);
<a name="line753">753: </a>  }
<a name="line754">754: </a>  <font color="#4169E1">return</font>(0);
<a name="line755">755: </a>}
<a name="line756">756: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line760">760: </a><strong><font color="#4169E1"><a name="PCBDDCSetDofsSplittingLocal_BDDC"></a>static <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCBDDCSetDofsSplittingLocal_BDDC(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A> n_is, <A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> ISForDofs[])</font></strong>
<a name="line761">761: </a>{
<a name="line762">762: </a>  PC_BDDC  *pcbddc = (PC_BDDC*)pc-&gt;data;
<a name="line763">763: </a>  <A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A> i;

<a name="line767">767: </a>  <font color="#B22222">/* Destroy ISes if they were already set */</font>
<a name="line768">768: </a>  <font color="#4169E1">for</font> (i=0;i&lt;pcbddc-&gt;n_ISForDofsLocal;i++) {
<a name="line769">769: </a>    <A href="../../../../../docs/manualpages/IS/ISDestroy.html#ISDestroy">ISDestroy</A>(&amp;pcbddc-&gt;ISForDofsLocal[i]);
<a name="line770">770: </a>  }
<a name="line771">771: </a>  <A href="../../../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</A>(pcbddc-&gt;ISForDofsLocal);
<a name="line772">772: </a>  <font color="#B22222">/* last user setting takes precendence -&gt; destroy any other customization */</font>
<a name="line773">773: </a>  <font color="#4169E1">for</font> (i=0;i&lt;pcbddc-&gt;n_ISForDofs;i++) {
<a name="line774">774: </a>    <A href="../../../../../docs/manualpages/IS/ISDestroy.html#ISDestroy">ISDestroy</A>(&amp;pcbddc-&gt;ISForDofs[i]);
<a name="line775">775: </a>  }
<a name="line776">776: </a>  <A href="../../../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</A>(pcbddc-&gt;ISForDofs);
<a name="line777">777: </a>  pcbddc-&gt;n_ISForDofs = 0;
<a name="line778">778: </a>  <font color="#B22222">/* allocate space then set */</font>
<a name="line779">779: </a>  <A href="../../../../../docs/manualpages/Sys/PetscMalloc.html#PetscMalloc">PetscMalloc</A>(n_is*<font color="#4169E1">sizeof</font>(<A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A>),&amp;pcbddc-&gt;ISForDofsLocal);
<a name="line780">780: </a>  <font color="#4169E1">for</font> (i=0;i&lt;n_is;i++) {
<a name="line781">781: </a>    <A href="../../../../../docs/manualpages/Sys/PetscObjectReference.html#PetscObjectReference">PetscObjectReference</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)ISForDofs[i]);
<a name="line782">782: </a>    pcbddc-&gt;ISForDofsLocal[i]=ISForDofs[i];
<a name="line783">783: </a>  }
<a name="line784">784: </a>  pcbddc-&gt;n_ISForDofsLocal=n_is;
<a name="line785">785: </a>  <font color="#4169E1">if</font> (n_is) pcbddc-&gt;user_provided_isfordofs = <A href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</A>;
<a name="line786">786: </a>  pcbddc-&gt;recompute_topography = <A href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</A>;
<a name="line787">787: </a>  <font color="#4169E1">return</font>(0);
<a name="line788">788: </a>}

<a name="line792">792: </a><font color="#B22222">/*@</font>
<a name="line793">793: </a><font color="#B22222"> <A href="../../../../../docs/manualpages/PC/PCBDDCSetDofsSplittingLocal.html#PCBDDCSetDofsSplittingLocal">PCBDDCSetDofsSplittingLocal</A> - Set index sets defining fields of the local subdomain matrix</font>

<a name="line795">795: </a><font color="#B22222">   Collective</font>

<a name="line797">797: </a><font color="#B22222">   Input Parameters:</font>
<a name="line798">798: </a><font color="#B22222">+  pc - the preconditioning context</font>
<a name="line799">799: </a><font color="#B22222">-  n_is - number of index sets defining the fields</font>
<a name="line800">800: </a><font color="#B22222">.  ISForDofs - array of <A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> describing the fields in local ordering</font>

<a name="line802">802: </a><font color="#B22222">   Level: intermediate</font>

<a name="line804">804: </a><font color="#B22222">   Notes: n_is should be the same among processes. Not all nodes need to be listed: unlisted nodes will belong to a different field.</font>

<a name="line806">806: </a><font color="#B22222">.seealso: <A href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</A></font>
<a name="line807">807: </a><font color="#B22222">@*/</font>
<a name="line808">808: </a><strong><font color="#4169E1"><a name="PCBDDCSetDofsSplittingLocal"></a><A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> <A href="../../../../../docs/manualpages/PC/PCBDDCSetDofsSplittingLocal.html#PCBDDCSetDofsSplittingLocal">PCBDDCSetDofsSplittingLocal</A>(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A> n_is, <A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> ISForDofs[])</font></strong>
<a name="line809">809: </a>{
<a name="line810">810: </a>  <A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A>       i;

<a name="line816">816: </a>  <font color="#4169E1">for</font> (i=0;i&lt;n_is;i++) {
<a name="line819">819: </a>  }
<a name="line820">820: </a>  PetscTryMethod(pc,<font color="#666666">"PCBDDCSetDofsSplitting_C"</font>,(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A>,<A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A>,<A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A>[]),(pc,n_is,ISForDofs));
<a name="line821">821: </a>  <font color="#4169E1">return</font>(0);
<a name="line822">822: </a>}
<a name="line823">823: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line827">827: </a><strong><font color="#4169E1"><a name="PCBDDCSetDofsSplitting_BDDC"></a>static <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCBDDCSetDofsSplitting_BDDC(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A> n_is, <A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> ISForDofs[])</font></strong>
<a name="line828">828: </a>{
<a name="line829">829: </a>  PC_BDDC  *pcbddc = (PC_BDDC*)pc-&gt;data;
<a name="line830">830: </a>  <A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A> i;

<a name="line834">834: </a>  <font color="#B22222">/* Destroy ISes if they were already set */</font>
<a name="line835">835: </a>  <font color="#4169E1">for</font> (i=0;i&lt;pcbddc-&gt;n_ISForDofs;i++) {
<a name="line836">836: </a>    <A href="../../../../../docs/manualpages/IS/ISDestroy.html#ISDestroy">ISDestroy</A>(&amp;pcbddc-&gt;ISForDofs[i]);
<a name="line837">837: </a>  }
<a name="line838">838: </a>  <A href="../../../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</A>(pcbddc-&gt;ISForDofs);
<a name="line839">839: </a>  <font color="#B22222">/* last user setting takes precendence -&gt; destroy any other customization */</font>
<a name="line840">840: </a>  <font color="#4169E1">for</font> (i=0;i&lt;pcbddc-&gt;n_ISForDofsLocal;i++) {
<a name="line841">841: </a>    <A href="../../../../../docs/manualpages/IS/ISDestroy.html#ISDestroy">ISDestroy</A>(&amp;pcbddc-&gt;ISForDofsLocal[i]);
<a name="line842">842: </a>  }
<a name="line843">843: </a>  <A href="../../../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</A>(pcbddc-&gt;ISForDofsLocal);
<a name="line844">844: </a>  pcbddc-&gt;n_ISForDofsLocal = 0;
<a name="line845">845: </a>  <font color="#B22222">/* allocate space then set */</font>
<a name="line846">846: </a>  <A href="../../../../../docs/manualpages/Sys/PetscMalloc1.html#PetscMalloc1">PetscMalloc1</A>(n_is,&amp;pcbddc-&gt;ISForDofs);
<a name="line847">847: </a>  <font color="#4169E1">for</font> (i=0;i&lt;n_is;i++) {
<a name="line848">848: </a>    <A href="../../../../../docs/manualpages/Sys/PetscObjectReference.html#PetscObjectReference">PetscObjectReference</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)ISForDofs[i]);
<a name="line849">849: </a>    pcbddc-&gt;ISForDofs[i]=ISForDofs[i];
<a name="line850">850: </a>  }
<a name="line851">851: </a>  pcbddc-&gt;n_ISForDofs=n_is;
<a name="line852">852: </a>  <font color="#4169E1">if</font> (n_is) pcbddc-&gt;user_provided_isfordofs = <A href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</A>;
<a name="line853">853: </a>  pcbddc-&gt;recompute_topography = <A href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</A>;
<a name="line854">854: </a>  <font color="#4169E1">return</font>(0);
<a name="line855">855: </a>}

<a name="line859">859: </a><font color="#B22222">/*@</font>
<a name="line860">860: </a><font color="#B22222"> <A href="../../../../../docs/manualpages/PC/PCBDDCSetDofsSplitting.html#PCBDDCSetDofsSplitting">PCBDDCSetDofsSplitting</A> - Set index sets defining fields of the global matrix</font>

<a name="line862">862: </a><font color="#B22222">   Collective</font>

<a name="line864">864: </a><font color="#B22222">   Input Parameters:</font>
<a name="line865">865: </a><font color="#B22222">+  pc - the preconditioning context</font>
<a name="line866">866: </a><font color="#B22222">-  n_is - number of index sets defining the fields</font>
<a name="line867">867: </a><font color="#B22222">.  ISForDofs - array of <A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> describing the fields in global ordering</font>

<a name="line869">869: </a><font color="#B22222">   Level: intermediate</font>

<a name="line871">871: </a><font color="#B22222">   Notes: Any process can list any global node. Not all nodes need to be listed: unlisted nodes will belong to a different field.</font>

<a name="line873">873: </a><font color="#B22222">.seealso: <A href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</A></font>
<a name="line874">874: </a><font color="#B22222">@*/</font>
<a name="line875">875: </a><strong><font color="#4169E1"><a name="PCBDDCSetDofsSplitting"></a><A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> <A href="../../../../../docs/manualpages/PC/PCBDDCSetDofsSplitting.html#PCBDDCSetDofsSplitting">PCBDDCSetDofsSplitting</A>(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A> n_is, <A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A> ISForDofs[])</font></strong>
<a name="line876">876: </a>{
<a name="line877">877: </a>  <A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A>       i;

<a name="line883">883: </a>  <font color="#4169E1">for</font> (i=0;i&lt;n_is;i++) {
<a name="line886">886: </a>  }
<a name="line887">887: </a>  PetscTryMethod(pc,<font color="#666666">"PCBDDCSetDofsSplitting_C"</font>,(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A>,<A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A>,<A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A>[]),(pc,n_is,ISForDofs));
<a name="line888">888: </a>  <font color="#4169E1">return</font>(0);
<a name="line889">889: </a>}
<a name="line890">890: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>
<a name="line893">893: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>
<a name="line894">894: </a><font color="#B22222">/*</font>
<a name="line895">895: </a><font color="#B22222">   PCPreSolve_BDDC - Changes the right hand side and (if necessary) the initial</font>
<a name="line896">896: </a><font color="#B22222">                     guess if a transformation of basis approach has been selected.</font>

<a name="line898">898: </a><font color="#B22222">   Input Parameter:</font>
<a name="line899">899: </a><font color="#B22222">+  pc - the preconditioner contex</font>

<a name="line901">901: </a><font color="#B22222">   Application Interface Routine: <A href="../../../../../docs/manualpages/PC/PCPreSolve.html#PCPreSolve">PCPreSolve</A>()</font>

<a name="line903">903: </a><font color="#B22222">   Notes:</font>
<a name="line904">904: </a><font color="#B22222">   The interface routine <A href="../../../../../docs/manualpages/PC/PCPreSolve.html#PCPreSolve">PCPreSolve</A>() is not usually called directly by</font>
<a name="line905">905: </a><font color="#B22222">   the user, but instead is called by <A href="../../../../../docs/manualpages/KSP/KSPSolve.html#KSPSolve">KSPSolve</A>().</font>
<a name="line906">906: </a><font color="#B22222">*/</font>
<a name="line907">907: </a><strong><font color="#4169E1"><a name="PCPreSolve_BDDC"></a>static <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCPreSolve_BDDC(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc, <A href="../../../../../docs/manualpages/KSP/KSP.html#KSP">KSP</A> ksp, <A href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</A> rhs, <A href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</A> x)</font></strong>
<a name="line908">908: </a>{
<a name="line910">910: </a>  PC_BDDC        *pcbddc = (PC_BDDC*)pc-&gt;data;
<a name="line911">911: </a>  PC_IS          *pcis = (PC_IS*)(pc-&gt;data);
<a name="line912">912: </a>  Mat_IS         *matis = (Mat_IS*)pc-&gt;pmat-&gt;data;
<a name="line913">913: </a>  <A href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</A>            temp_mat;
<a name="line914">914: </a>  <A href="../../../../../docs/manualpages/IS/IS.html#IS">IS</A>             dirIS;
<a name="line915">915: </a>  <A href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</A>            used_vec;
<a name="line916">916: </a>  <A href="../../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</A>      guess_nonzero;

<a name="line919">919: </a>  <font color="#B22222">/* if we are working with cg, one dirichlet solve can be avoided during Krylov iterations */</font>
<a name="line920">920: </a>  <font color="#4169E1">if</font> (ksp) {
<a name="line921">921: </a>    <A href="../../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</A> iscg;
<a name="line922">922: </a>    <A href="../../../../../docs/manualpages/Sys/PetscObjectTypeCompare.html#PetscObjectTypeCompare">PetscObjectTypeCompare</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)ksp,<A href="../../../../../docs/manualpages/KSP/KSPCG.html#KSPCG">KSPCG</A>,&amp;iscg);
<a name="line923">923: </a>    <font color="#4169E1">if</font> (!iscg) {
<a name="line924">924: </a>      PCBDDCSetUseExactDirichlet(pc,<A href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</A>);
<a name="line925">925: </a>    }
<a name="line926">926: </a>  }
<a name="line927">927: </a>  <font color="#B22222">/* Creates parallel work vectors used in presolve */</font>
<a name="line928">928: </a>  <font color="#4169E1">if</font> (!pcbddc-&gt;original_rhs) {
<a name="line929">929: </a>    <A href="../../../../../docs/manualpages/Vec/VecDuplicate.html#VecDuplicate">VecDuplicate</A>(pcis-&gt;vec1_global,&amp;pcbddc-&gt;original_rhs);
<a name="line930">930: </a>  }
<a name="line931">931: </a>  <font color="#4169E1">if</font> (!pcbddc-&gt;temp_solution) {
<a name="line932">932: </a>    <A href="../../../../../docs/manualpages/Vec/VecDuplicate.html#VecDuplicate">VecDuplicate</A>(pcis-&gt;vec1_global,&amp;pcbddc-&gt;temp_solution);
<a name="line933">933: </a>  }
<a name="line934">934: </a>  <font color="#4169E1">if</font> (x) {
<a name="line935">935: </a>    <A href="../../../../../docs/manualpages/Sys/PetscObjectReference.html#PetscObjectReference">PetscObjectReference</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)x);
<a name="line936">936: </a>    used_vec = x;
<a name="line937">937: </a>  } <font color="#4169E1">else</font> {
<a name="line938">938: </a>    <A href="../../../../../docs/manualpages/Sys/PetscObjectReference.html#PetscObjectReference">PetscObjectReference</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pcbddc-&gt;temp_solution);
<a name="line939">939: </a>    used_vec = pcbddc-&gt;temp_solution;
<a name="line940">940: </a>    <A href="../../../../../docs/manualpages/Vec/VecSet.html#VecSet">VecSet</A>(used_vec,0.0);
<a name="line941">941: </a>  }
<a name="line942">942: </a>  <font color="#B22222">/* hack into ksp data structure <A href="../../../../../docs/manualpages/PC/PCPreSolve.html#PCPreSolve">PCPreSolve</A> comes earlier in src/ksp/ksp/interface/itfunc.c */</font>
<a name="line943">943: </a>  <font color="#4169E1">if</font> (ksp) {
<a name="line944">944: </a>    <A href="../../../../../docs/manualpages/KSP/KSPGetInitialGuessNonzero.html#KSPGetInitialGuessNonzero">KSPGetInitialGuessNonzero</A>(ksp,&amp;guess_nonzero);
<a name="line945">945: </a>    <font color="#4169E1">if</font> (!guess_nonzero) {
<a name="line946">946: </a>      <A href="../../../../../docs/manualpages/Vec/VecSet.html#VecSet">VecSet</A>(used_vec,0.0);
<a name="line947">947: </a>    }
<a name="line948">948: </a>  }

<a name="line950">950: </a>  <font color="#B22222">/* store the original rhs */</font>
<a name="line951">951: </a>  <A href="../../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</A>(rhs,pcbddc-&gt;original_rhs);

<a name="line953">953: </a>  <font color="#B22222">/* Take into account zeroed rows -&gt; change rhs and store solution removed */</font>
<a name="line954">954: </a>  <font color="#B22222">/* note that Dirichlet boundaries in global ordering (if any) has already been translated into local ordering in PCBDDCAnalyzeInterface */</font>
<a name="line955">955: </a>  <A href="../../../../../docs/manualpages/PC/PCBDDCGetDirichletBoundariesLocal.html#PCBDDCGetDirichletBoundariesLocal">PCBDDCGetDirichletBoundariesLocal</A>(pc,&amp;dirIS);
<a name="line956">956: </a>  <font color="#4169E1">if</font> (rhs &amp;&amp; dirIS) {
<a name="line957">957: </a>    <A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A>    dirsize,i,*is_indices;
<a name="line958">958: </a>    <A href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</A> *array_x,*array_diagonal;

<a name="line960">960: </a>    <A href="../../../../../docs/manualpages/Mat/MatGetDiagonal.html#MatGetDiagonal">MatGetDiagonal</A>(pc-&gt;pmat,pcis-&gt;vec1_global);
<a name="line961">961: </a>    <A href="../../../../../docs/manualpages/Vec/VecPointwiseDivide.html#VecPointwiseDivide">VecPointwiseDivide</A>(pcis-&gt;vec1_global,rhs,pcis-&gt;vec1_global);
<a name="line962">962: </a>    <A href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</A>(matis-&gt;ctx,pcis-&gt;vec1_global,pcis-&gt;vec2_N,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</A>);
<a name="line963">963: </a>    <A href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</A>(matis-&gt;ctx,pcis-&gt;vec1_global,pcis-&gt;vec2_N,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</A>);
<a name="line964">964: </a>    <A href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</A>(matis-&gt;ctx,used_vec,pcis-&gt;vec1_N,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</A>);
<a name="line965">965: </a>    <A href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</A>(matis-&gt;ctx,used_vec,pcis-&gt;vec1_N,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</A>);
<a name="line966">966: </a>    <A href="../../../../../docs/manualpages/IS/ISGetLocalSize.html#ISGetLocalSize">ISGetLocalSize</A>(dirIS,&amp;dirsize);
<a name="line967">967: </a>    <A href="../../../../../docs/manualpages/Vec/VecGetArray.html#VecGetArray">VecGetArray</A>(pcis-&gt;vec1_N,&amp;array_x);
<a name="line968">968: </a>    <A href="../../../../../docs/manualpages/Vec/VecGetArray.html#VecGetArray">VecGetArray</A>(pcis-&gt;vec2_N,&amp;array_diagonal);
<a name="line969">969: </a>    <A href="../../../../../docs/manualpages/IS/ISGetIndices.html#ISGetIndices">ISGetIndices</A>(dirIS,(const <A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A>**)&amp;is_indices);
<a name="line970">970: </a>    <font color="#4169E1">for</font> (i=0; i&lt;dirsize; i++) array_x[is_indices[i]] = array_diagonal[is_indices[i]];
<a name="line971">971: </a>    <A href="../../../../../docs/manualpages/IS/ISRestoreIndices.html#ISRestoreIndices">ISRestoreIndices</A>(dirIS,(const <A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A>**)&amp;is_indices);
<a name="line972">972: </a>    <A href="../../../../../docs/manualpages/Vec/VecRestoreArray.html#VecRestoreArray">VecRestoreArray</A>(pcis-&gt;vec2_N,&amp;array_diagonal);
<a name="line973">973: </a>    <A href="../../../../../docs/manualpages/Vec/VecRestoreArray.html#VecRestoreArray">VecRestoreArray</A>(pcis-&gt;vec1_N,&amp;array_x);
<a name="line974">974: </a>    <A href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</A>(matis-&gt;ctx,pcis-&gt;vec1_N,used_vec,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</A>);
<a name="line975">975: </a>    <A href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</A>(matis-&gt;ctx,pcis-&gt;vec1_N,used_vec,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</A>);

<a name="line977">977: </a>    <font color="#B22222">/* remove the computed solution from the rhs */</font>
<a name="line978">978: </a>    <A href="../../../../../docs/manualpages/Vec/VecScale.html#VecScale">VecScale</A>(used_vec,-1.0);
<a name="line979">979: </a>    <A href="../../../../../docs/manualpages/Mat/MatMultAdd.html#MatMultAdd">MatMultAdd</A>(pc-&gt;pmat,used_vec,rhs,rhs);
<a name="line980">980: </a>    <A href="../../../../../docs/manualpages/Vec/VecScale.html#VecScale">VecScale</A>(used_vec,-1.0);
<a name="line981">981: </a>  }

<a name="line983">983: </a>  <font color="#B22222">/* store partially computed solution and set initial guess */</font>
<a name="line984">984: </a>  <font color="#4169E1">if</font> (x) {
<a name="line985">985: </a>    <A href="../../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</A>(used_vec,pcbddc-&gt;temp_solution);
<a name="line986">986: </a>    <A href="../../../../../docs/manualpages/Vec/VecSet.html#VecSet">VecSet</A>(used_vec,0.0);
<a name="line987">987: </a>    <font color="#4169E1">if</font> (pcbddc-&gt;use_exact_dirichlet_trick) {
<a name="line988">988: </a>      <A href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</A>(pcis-&gt;global_to_D,rhs,pcis-&gt;vec1_D,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</A>);
<a name="line989">989: </a>      <A href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</A>  (pcis-&gt;global_to_D,rhs,pcis-&gt;vec1_D,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</A>);
<a name="line990">990: </a>      <A href="../../../../../docs/manualpages/KSP/KSPSolve.html#KSPSolve">KSPSolve</A>(pcbddc-&gt;ksp_D,pcis-&gt;vec1_D,pcis-&gt;vec2_D);
<a name="line991">991: </a>      <A href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</A>(pcis-&gt;global_to_D,pcis-&gt;vec2_D,used_vec,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</A>);
<a name="line992">992: </a>      <A href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</A>  (pcis-&gt;global_to_D,pcis-&gt;vec2_D,used_vec,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</A>);
<a name="line993">993: </a>      <font color="#4169E1">if</font> (ksp) {
<a name="line994">994: </a>        <A href="../../../../../docs/manualpages/KSP/KSPSetInitialGuessNonzero.html#KSPSetInitialGuessNonzero">KSPSetInitialGuessNonzero</A>(ksp,<A href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</A>);
<a name="line995">995: </a>      }
<a name="line996">996: </a>    }
<a name="line997">997: </a>  }

<a name="line999">999: </a>  <font color="#B22222">/* prepare <A href="../../../../../docs/manualpages/Mat/MatMult.html#MatMult">MatMult</A> and rhs for solver */</font>
<a name="line1000">1000: </a>  <font color="#4169E1">if</font> (pcbddc-&gt;ChangeOfBasisMatrix) {
<a name="line1001">1001: </a>    <font color="#B22222">/* swap pointers for local matrices */</font>
<a name="line1002">1002: </a>    temp_mat = matis-&gt;A;
<a name="line1003">1003: </a>    matis-&gt;A = pcbddc-&gt;local_mat;
<a name="line1004">1004: </a>    pcbddc-&gt;local_mat = temp_mat;
<a name="line1005">1005: </a>    <font color="#4169E1">if</font> (rhs) {
<a name="line1006">1006: </a>      <font color="#B22222">/* Get local rhs and apply transformation of basis */</font>
<a name="line1007">1007: </a>      <A href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</A>(pcis-&gt;global_to_B,rhs,pcis-&gt;vec1_B,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</A>);
<a name="line1008">1008: </a>      <A href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</A>  (pcis-&gt;global_to_B,rhs,pcis-&gt;vec1_B,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</A>);
<a name="line1009">1009: </a>      <font color="#B22222">/* from original basis to modified basis */</font>
<a name="line1010">1010: </a>      <A href="../../../../../docs/manualpages/Mat/MatMultTranspose.html#MatMultTranspose">MatMultTranspose</A>(pcbddc-&gt;ChangeOfBasisMatrix,pcis-&gt;vec1_B,pcis-&gt;vec2_B);
<a name="line1011">1011: </a>      <font color="#B22222">/* put back modified values into the global vec using <A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A> copy mode */</font>
<a name="line1012">1012: </a>      <A href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</A>(pcis-&gt;global_to_B,pcis-&gt;vec2_B,rhs,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</A>);
<a name="line1013">1013: </a>      <A href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</A>  (pcis-&gt;global_to_B,pcis-&gt;vec2_B,rhs,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</A>);
<a name="line1014">1014: </a>    }
<a name="line1015">1015: </a>  }

<a name="line1017">1017: </a>  <font color="#B22222">/* remove nullspace if present */</font>
<a name="line1018">1018: </a>  <font color="#4169E1">if</font> (ksp &amp;&amp; pcbddc-&gt;NullSpace) {
<a name="line1019">1019: </a>    <A href="../../../../../docs/manualpages/Mat/MatNullSpaceRemove.html#MatNullSpaceRemove">MatNullSpaceRemove</A>(pcbddc-&gt;NullSpace,used_vec);
<a name="line1020">1020: </a>    <A href="../../../../../docs/manualpages/Mat/MatNullSpaceRemove.html#MatNullSpaceRemove">MatNullSpaceRemove</A>(pcbddc-&gt;NullSpace,rhs);
<a name="line1021">1021: </a>  }
<a name="line1022">1022: </a>  <A href="../../../../../docs/manualpages/Vec/VecDestroy.html#VecDestroy">VecDestroy</A>(&amp;used_vec);
<a name="line1023">1023: </a>  <font color="#4169E1">return</font>(0);
<a name="line1024">1024: </a>}
<a name="line1025">1025: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>
<a name="line1028">1028: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>
<a name="line1029">1029: </a><font color="#B22222">/*</font>
<a name="line1030">1030: </a><font color="#B22222">   PCPostSolve_BDDC - Changes the computed solution if a transformation of basis</font>
<a name="line1031">1031: </a><font color="#B22222">                     approach has been selected. Also, restores rhs to its original state.</font>

<a name="line1033">1033: </a><font color="#B22222">   Input Parameter:</font>
<a name="line1034">1034: </a><font color="#B22222">+  pc - the preconditioner contex</font>

<a name="line1036">1036: </a><font color="#B22222">   Application Interface Routine: <A href="../../../../../docs/manualpages/PC/PCPostSolve.html#PCPostSolve">PCPostSolve</A>()</font>

<a name="line1038">1038: </a><font color="#B22222">   Notes:</font>
<a name="line1039">1039: </a><font color="#B22222">   The interface routine <A href="../../../../../docs/manualpages/PC/PCPostSolve.html#PCPostSolve">PCPostSolve</A>() is not usually called directly by</font>
<a name="line1040">1040: </a><font color="#B22222">   the user, but instead is called by <A href="../../../../../docs/manualpages/KSP/KSPSolve.html#KSPSolve">KSPSolve</A>().</font>
<a name="line1041">1041: </a><font color="#B22222">*/</font>
<a name="line1042">1042: </a><strong><font color="#4169E1"><a name="PCPostSolve_BDDC"></a>static <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCPostSolve_BDDC(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc, <A href="../../../../../docs/manualpages/KSP/KSP.html#KSP">KSP</A> ksp, <A href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</A> rhs, <A href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</A> x)</font></strong>
<a name="line1043">1043: </a>{
<a name="line1045">1045: </a>  PC_BDDC        *pcbddc = (PC_BDDC*)pc-&gt;data;
<a name="line1046">1046: </a>  PC_IS          *pcis   = (PC_IS*)(pc-&gt;data);
<a name="line1047">1047: </a>  Mat_IS         *matis = (Mat_IS*)pc-&gt;pmat-&gt;data;
<a name="line1048">1048: </a>  <A href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</A>            temp_mat;

<a name="line1051">1051: </a>  <font color="#4169E1">if</font> (pcbddc-&gt;ChangeOfBasisMatrix) {
<a name="line1052">1052: </a>    <font color="#B22222">/* swap pointers for local matrices */</font>
<a name="line1053">1053: </a>    temp_mat = matis-&gt;A;
<a name="line1054">1054: </a>    matis-&gt;A = pcbddc-&gt;local_mat;
<a name="line1055">1055: </a>    pcbddc-&gt;local_mat = temp_mat;
<a name="line1056">1056: </a>  }
<a name="line1057">1057: </a>  <font color="#4169E1">if</font> (pcbddc-&gt;ChangeOfBasisMatrix &amp;&amp; x) {
<a name="line1058">1058: </a>    <font color="#B22222">/* Get Local boundary and apply transformation of basis to solution vector */</font>
<a name="line1059">1059: </a>    <A href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</A>(pcis-&gt;global_to_B,x,pcis-&gt;vec1_B,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</A>);
<a name="line1060">1060: </a>    <A href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</A>  (pcis-&gt;global_to_B,x,pcis-&gt;vec1_B,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</A>);
<a name="line1061">1061: </a>    <font color="#B22222">/* from modified basis to original basis */</font>
<a name="line1062">1062: </a>    <A href="../../../../../docs/manualpages/Mat/MatMult.html#MatMult">MatMult</A>(pcbddc-&gt;ChangeOfBasisMatrix,pcis-&gt;vec1_B,pcis-&gt;vec2_B);
<a name="line1063">1063: </a>    <font color="#B22222">/* put back modified values into the global vec using <A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A> copy mode */</font>
<a name="line1064">1064: </a>    <A href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</A>(pcis-&gt;global_to_B,pcis-&gt;vec2_B,x,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</A>);
<a name="line1065">1065: </a>    <A href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</A>  (pcis-&gt;global_to_B,pcis-&gt;vec2_B,x,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</A>);
<a name="line1066">1066: </a>  }
<a name="line1067">1067: </a>  <font color="#B22222">/* add solution removed in presolve */</font>
<a name="line1068">1068: </a>  <font color="#4169E1">if</font> (x) {
<a name="line1069">1069: </a>    <A href="../../../../../docs/manualpages/Vec/VecAXPY.html#VecAXPY">VecAXPY</A>(x,1.0,pcbddc-&gt;temp_solution);
<a name="line1070">1070: </a>  }
<a name="line1071">1071: </a>  <font color="#B22222">/* restore rhs to its original state */</font>
<a name="line1072">1072: </a>  <font color="#4169E1">if</font> (rhs) {
<a name="line1073">1073: </a>    <A href="../../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</A>(pcbddc-&gt;original_rhs,rhs);
<a name="line1074">1074: </a>  }
<a name="line1075">1075: </a>  <font color="#4169E1">return</font>(0);
<a name="line1076">1076: </a>}
<a name="line1077">1077: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>
<a name="line1080">1080: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>
<a name="line1081">1081: </a><font color="#B22222">/*</font>
<a name="line1082">1082: </a><font color="#B22222">   PCSetUp_BDDC - Prepares for the use of the BDDC preconditioner</font>
<a name="line1083">1083: </a><font color="#B22222">                  by setting data structures and options.</font>

<a name="line1085">1085: </a><font color="#B22222">   Input Parameter:</font>
<a name="line1086">1086: </a><font color="#B22222">+  pc - the preconditioner context</font>

<a name="line1088">1088: </a><font color="#B22222">   Application Interface Routine: <A href="../../../../../docs/manualpages/PC/PCSetUp.html#PCSetUp">PCSetUp</A>()</font>

<a name="line1090">1090: </a><font color="#B22222">   Notes:</font>
<a name="line1091">1091: </a><font color="#B22222">   The interface routine <A href="../../../../../docs/manualpages/PC/PCSetUp.html#PCSetUp">PCSetUp</A>() is not usually called directly by</font>
<a name="line1092">1092: </a><font color="#B22222">   the user, but instead is called by <A href="../../../../../docs/manualpages/PC/PCApply.html#PCApply">PCApply</A>() if necessary.</font>
<a name="line1093">1093: </a><font color="#B22222">*/</font>
<a name="line1094">1094: </a><strong><font color="#4169E1"><a name="PCSetUp_BDDC"></a><A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCSetUp_BDDC(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc)</font></strong>
<a name="line1095">1095: </a>{
<a name="line1096">1096: </a>  <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A>   ierr;
<a name="line1097">1097: </a>  PC_BDDC*         pcbddc = (PC_BDDC*)pc-&gt;data;
<a name="line1098">1098: </a>  <A href="../../../../../docs/manualpages/Mat/MatNullSpace.html#MatNullSpace">MatNullSpace</A>     nearnullspace;
<a name="line1099">1099: </a>  <A href="../../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</A>        computeis,computetopography,computesolvers;
<a name="line1100">1100: </a>  <A href="../../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</A>        new_nearnullspace_provided;

<a name="line1103">1103: </a>  <font color="#B22222">/* the following lines of code should be replaced by a better logic between PCIS, <A href="../../../../../docs/manualpages/PC/PCNN.html#PCNN">PCNN</A>, <A href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</A> and other future nonoverlapping preconditioners */</font>
<a name="line1104">1104: </a>  <font color="#B22222">/* For BDDC we need to define a local "Neumann" problem different to that defined in PCISSetup</font>
<a name="line1105">1105: </a><font color="#B22222">     Also, BDDC directly build the Dirichlet problem */</font>
<a name="line1106">1106: </a>  <font color="#B22222">/* split work */</font>
<a name="line1107">1107: </a>  <font color="#4169E1">if</font> (pc-&gt;setupcalled) {
<a name="line1108">1108: </a>    computeis = <A href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</A>;
<a name="line1109">1109: </a>    <font color="#4169E1">if</font> (pc-&gt;flag == SAME_NONZERO_PATTERN) {
<a name="line1110">1110: </a>      computetopography = <A href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</A>;
<a name="line1111">1111: </a>      computesolvers = <A href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</A>;
<a name="line1112">1112: </a>    } <font color="#4169E1">else</font> { <font color="#B22222">/* DIFFERENT_NONZERO_PATTERN */</font>
<a name="line1113">1113: </a>      computetopography = <A href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</A>;
<a name="line1114">1114: </a>      computesolvers = <A href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</A>;
<a name="line1115">1115: </a>    }
<a name="line1116">1116: </a>  } <font color="#4169E1">else</font> {
<a name="line1117">1117: </a>    computeis = <A href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</A>;
<a name="line1118">1118: </a>    computetopography = <A href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</A>;
<a name="line1119">1119: </a>    computesolvers = <A href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</A>;
<a name="line1120">1120: </a>  }
<a name="line1121">1121: </a>  <font color="#4169E1">if</font> (pcbddc-&gt;recompute_topography) {
<a name="line1122">1122: </a>    computetopography = <A href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</A>;
<a name="line1123">1123: </a>  }

<a name="line1125">1125: </a>  <font color="#B22222">/* Get stdout for dbg */</font>
<a name="line1126">1126: </a>  <font color="#4169E1">if</font> (pcbddc-&gt;dbg_flag) {
<a name="line1127">1127: </a>    <font color="#4169E1">if</font> (!pcbddc-&gt;dbg_viewer) {
<a name="line1128">1128: </a>      pcbddc-&gt;dbg_viewer = <A href="../../../../../docs/manualpages/Viewer/PETSC_VIEWER_STDOUT_.html#PETSC_VIEWER_STDOUT_">PETSC_VIEWER_STDOUT_</A>(<A href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc));
<a name="line1129">1129: </a>      <A href="../../../../../docs/manualpages/Viewer/PetscViewerASCIISynchronizedAllow.html#PetscViewerASCIISynchronizedAllow">PetscViewerASCIISynchronizedAllow</A>(pcbddc-&gt;dbg_viewer,<A href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</A>);
<a name="line1130">1130: </a>    }
<a name="line1131">1131: </a>    <A href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIAddTab.html#PetscViewerASCIIAddTab">PetscViewerASCIIAddTab</A>(pcbddc-&gt;dbg_viewer,2*pcbddc-&gt;current_level);
<a name="line1132">1132: </a>  }

<a name="line1134">1134: </a>  <font color="#B22222">/* Set up all the "iterative substructuring" common block without computing solvers */</font>
<a name="line1135">1135: </a>  <font color="#4169E1">if</font> (computeis) {
<a name="line1136">1136: </a>    <font color="#B22222">/* HACK INTO PCIS */</font>
<a name="line1137">1137: </a>    PC_IS* pcis = (PC_IS*)pc-&gt;data;
<a name="line1138">1138: </a>    pcis-&gt;computesolvers = <A href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</A>;
<a name="line1139">1139: </a>    PCISSetUp(pc);
<a name="line1140">1140: </a>    <A href="../../../../../docs/manualpages/IS/ISLocalToGlobalMappingCreateIS.html#ISLocalToGlobalMappingCreateIS">ISLocalToGlobalMappingCreateIS</A>(pcis-&gt;is_B_local,&amp;pcbddc-&gt;BtoNmap);
<a name="line1141">1141: </a>  }

<a name="line1143">1143: </a>  <font color="#B22222">/* check user defined change of basis (if any) */</font>
<a name="line1144">1144: </a>  <font color="#4169E1">if</font> (pcbddc-&gt;user_ChangeOfBasisMatrix) {
<a name="line1145">1145: </a>    PC_IS* pcis= (PC_IS*)pc-&gt;data;
<a name="line1146">1146: </a>    <A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A> n,m;
<a name="line1147">1147: </a>    <A href="../../../../../docs/manualpages/Mat/MatGetSize.html#MatGetSize">MatGetSize</A>(pcbddc-&gt;user_ChangeOfBasisMatrix,&amp;n,&amp;m);
<a name="line1148">1148: </a>    <font color="#4169E1">if</font> (n != m) {
<a name="line1149">1149: </a>      <A href="../../../../../docs/manualpages/Sys/SETERRQ2.html#SETERRQ2">SETERRQ2</A>(<A href="../../../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</A>,PETSC_ERR_SUP,<font color="#666666">"Change of basis matrix should be square %d != %d\n"</font>,n,m);
<a name="line1150">1150: </a>    } <font color="#4169E1">else</font> <font color="#4169E1">if</font> (n != pcis-&gt;n_B &amp;&amp; n != pcis-&gt;n) {
<a name="line1151">1151: </a>      <A href="../../../../../docs/manualpages/Sys/SETERRQ3.html#SETERRQ3">SETERRQ3</A>(<A href="../../../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</A>,PETSC_ERR_SUP,<font color="#666666">"Size of change of basis matrix %d differs from boundary size %d and local size %d\n"</font>,n,pcis-&gt;n_B,pcis-&gt;n);
<a name="line1152">1152: </a>    }
<a name="line1153">1153: </a>    <font color="#B22222">/* use_change_of_basis flag is used to automatically compute a change of basis from constraints */</font>
<a name="line1154">1154: </a>    pcbddc-&gt;use_change_of_basis = <A href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</A>;
<a name="line1155">1155: </a>  }
<a name="line1156">1156: </a>  <font color="#B22222">/* Analyze interface */</font>
<a name="line1157">1157: </a>  <font color="#4169E1">if</font> (computetopography) {
<a name="line1158">1158: </a>    PCBDDCAnalyzeInterface(pc);
<a name="line1159">1159: </a>  }

<a name="line1161">1161: </a>  <font color="#B22222">/* infer if NullSpace object attached to <A href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</A> via <A href="../../../../../docs/manualpages/Mat/MatSetNearNullSpace.html#MatSetNearNullSpace">MatSetNearNullSpace</A> has changed */</font>
<a name="line1162">1162: </a>  new_nearnullspace_provided = <A href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</A>;
<a name="line1163">1163: </a>  <A href="../../../../../docs/manualpages/Mat/MatGetNearNullSpace.html#MatGetNearNullSpace">MatGetNearNullSpace</A>(pc-&gt;pmat,&amp;nearnullspace);
<a name="line1164">1164: </a>  <font color="#4169E1">if</font> (pcbddc-&gt;onearnullspace) { <font color="#B22222">/* already used nearnullspace */</font>
<a name="line1165">1165: </a>    <font color="#4169E1">if</font> (!nearnullspace) { <font color="#B22222">/* near null space attached to mat has been destroyed */</font>
<a name="line1166">1166: </a>      new_nearnullspace_provided = <A href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</A>;
<a name="line1167">1167: </a>    } <font color="#4169E1">else</font> {
<a name="line1168">1168: </a>      <font color="#B22222">/* determine if the two nullspaces are different (should be lightweight) */</font>
<a name="line1169">1169: </a>      <font color="#4169E1">if</font> (nearnullspace != pcbddc-&gt;onearnullspace) {
<a name="line1170">1170: </a>        new_nearnullspace_provided = <A href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</A>;
<a name="line1171">1171: </a>      } <font color="#4169E1">else</font> { <font color="#B22222">/* maybe the user has changed the content of the nearnullspace so check vectors ObjectStateId */</font>
<a name="line1172">1172: </a>        <A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A>         i;
<a name="line1173">1173: </a>        const <A href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</A>        *nearnullvecs;
<a name="line1174">1174: </a>        <A href="../../../../../docs/manualpages/Sys/PetscObjectState.html#PetscObjectState">PetscObjectState</A> state;
<a name="line1175">1175: </a>        <A href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</A>         nnsp_size;
<a name="line1176">1176: </a>        <A href="../../../../../docs/manualpages/Mat/MatNullSpaceGetVecs.html#MatNullSpaceGetVecs">MatNullSpaceGetVecs</A>(nearnullspace,NULL,&amp;nnsp_size,&amp;nearnullvecs);
<a name="line1177">1177: </a>        <font color="#4169E1">for</font> (i=0;i&lt;nnsp_size;i++) {
<a name="line1178">1178: </a>          <A href="../../../../../docs/manualpages/Sys/PetscObjectStateGet.html#PetscObjectStateGet">PetscObjectStateGet</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)nearnullvecs[i],&amp;state);
<a name="line1179">1179: </a>          <font color="#4169E1">if</font> (pcbddc-&gt;onearnullvecs_state[i] != state) {
<a name="line1180">1180: </a>            new_nearnullspace_provided = <A href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</A>;
<a name="line1181">1181: </a>            <font color="#4169E1">break</font>;
<a name="line1182">1182: </a>          }
<a name="line1183">1183: </a>        }
<a name="line1184">1184: </a>      }
<a name="line1185">1185: </a>    }
<a name="line1186">1186: </a>  } <font color="#4169E1">else</font> {
<a name="line1187">1187: </a>    <font color="#4169E1">if</font> (!nearnullspace) { <font color="#B22222">/* both nearnullspaces are null */</font>
<a name="line1188">1188: </a>      new_nearnullspace_provided = <A href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</A>;
<a name="line1189">1189: </a>    } <font color="#4169E1">else</font> { <font color="#B22222">/* nearnullspace attached later */</font>
<a name="line1190">1190: </a>      new_nearnullspace_provided = <A href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</A>;
<a name="line1191">1191: </a>    }
<a name="line1192">1192: </a>  }

<a name="line1194">1194: </a>  <font color="#B22222">/* Setup constraints and related work vectors */</font>
<a name="line1195">1195: </a>  <font color="#B22222">/* reset primal space flags */</font>
<a name="line1196">1196: </a>  pcbddc-&gt;new_primal_space = <A href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</A>;
<a name="line1197">1197: </a>  pcbddc-&gt;new_primal_space_local = <A href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</A>;
<a name="line1198">1198: </a>  <font color="#4169E1">if</font> (computetopography || new_nearnullspace_provided) {
<a name="line1199">1199: </a>    <font color="#B22222">/* It also sets the primal space flags */</font>
<a name="line1200">1200: </a>    PCBDDCConstraintsSetUp(pc);
<a name="line1201">1201: </a>    <font color="#B22222">/* Allocate needed local vectors (which depends on quantities defined during ConstraintsSetUp) */</font>
<a name="line1202">1202: </a>    PCBDDCSetUpLocalWorkVectors(pc);
<a name="line1203">1203: </a>  }

<a name="line1205">1205: </a>  <font color="#4169E1">if</font> (computesolvers || pcbddc-&gt;new_primal_space) {
<a name="line1206">1206: </a>    <font color="#B22222">/* reset data */</font>
<a name="line1207">1207: </a>    PCBDDCScalingDestroy(pc);
<a name="line1208">1208: </a>    <font color="#B22222">/* Create coarse and local stuffs */</font>
<a name="line1209">1209: </a>    PCBDDCSetUpSolvers(pc);
<a name="line1210">1210: </a>    PCBDDCScalingSetUp(pc);
<a name="line1211">1211: </a>  }

<a name="line1213">1213: </a>  <font color="#4169E1">if</font> (pcbddc-&gt;dbg_flag) {
<a name="line1214">1214: </a>    <A href="../../../../../docs/manualpages/Viewer/PetscViewerASCIISubtractTab.html#PetscViewerASCIISubtractTab">PetscViewerASCIISubtractTab</A>(pcbddc-&gt;dbg_viewer,2*pcbddc-&gt;current_level);
<a name="line1215">1215: </a>  }
<a name="line1216">1216: </a>  <font color="#4169E1">return</font>(0);
<a name="line1217">1217: </a>}

<a name="line1219">1219: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>
<a name="line1220">1220: </a><font color="#B22222">/*</font>
<a name="line1221">1221: </a><font color="#B22222">   PCApply_BDDC - Applies the BDDC operator to a vector.</font>

<a name="line1223">1223: </a><font color="#B22222">   Input Parameters:</font>
<a name="line1224">1224: </a><font color="#B22222">.  pc - the preconditioner context</font>
<a name="line1225">1225: </a><font color="#B22222">.  r - input vector (global)</font>

<a name="line1227">1227: </a><font color="#B22222">   Output Parameter:</font>
<a name="line1228">1228: </a><font color="#B22222">.  z - output vector (global)</font>

<a name="line1230">1230: </a><font color="#B22222">   Application Interface Routine: <A href="../../../../../docs/manualpages/PC/PCApply.html#PCApply">PCApply</A>()</font>
<a name="line1231">1231: </a><font color="#B22222"> */</font>
<a name="line1234">1234: </a><strong><font color="#4169E1"><a name="PCApply_BDDC"></a><A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCApply_BDDC(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</A> r,<A href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</A> z)</font></strong>
<a name="line1235">1235: </a>{
<a name="line1236">1236: </a>  PC_IS             *pcis = (PC_IS*)(pc-&gt;data);
<a name="line1237">1237: </a>  PC_BDDC           *pcbddc = (PC_BDDC*)(pc-&gt;data);
<a name="line1238">1238: </a>  <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A>    ierr;
<a name="line1239">1239: </a>  const <A href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</A> one = 1.0;
<a name="line1240">1240: </a>  const <A href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</A> m_one = -1.0;
<a name="line1241">1241: </a>  const <A href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</A> zero = 0.0;

<a name="line1243">1243: </a><font color="#B22222">/* This code is similar to that provided in nn.c for <A href="../../../../../docs/manualpages/PC/PCNN.html#PCNN">PCNN</A></font>
<a name="line1244">1244: </a><font color="#B22222">   NN interface preconditioner changed to BDDC</font>
<a name="line1245">1245: </a><font color="#B22222">   Added support for M_3 preconditioner in the reference article (code is active if pcbddc-&gt;switch_static = <A href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</A>) */</font>

<a name="line1248">1248: </a>  <font color="#4169E1">if</font> (!pcbddc-&gt;use_exact_dirichlet_trick) {
<a name="line1249">1249: </a>    <font color="#B22222">/* First Dirichlet solve */</font>
<a name="line1250">1250: </a>    <A href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</A>(pcis-&gt;global_to_D,r,pcis-&gt;vec1_D,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</A>);
<a name="line1251">1251: </a>    <A href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</A>(pcis-&gt;global_to_D,r,pcis-&gt;vec1_D,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</A>);
<a name="line1252">1252: </a>    <A href="../../../../../docs/manualpages/KSP/KSPSolve.html#KSPSolve">KSPSolve</A>(pcbddc-&gt;ksp_D,pcis-&gt;vec1_D,pcis-&gt;vec2_D);
<a name="line1253">1253: </a>    <font color="#B22222">/*</font>
<a name="line1254">1254: </a><font color="#B22222">      Assembling right hand side for BDDC operator</font>
<a name="line1255">1255: </a><font color="#B22222">      - pcis-&gt;vec1_D for the Dirichlet part (if needed, i.e. prec_flag=<A href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</A>)</font>
<a name="line1256">1256: </a><font color="#B22222">      - pcis-&gt;vec1_B the interface part of the global vector z</font>
<a name="line1257">1257: </a><font color="#B22222">    */</font>
<a name="line1258">1258: </a>    <A href="../../../../../docs/manualpages/Vec/VecScale.html#VecScale">VecScale</A>(pcis-&gt;vec2_D,m_one);
<a name="line1259">1259: </a>    <A href="../../../../../docs/manualpages/Mat/MatMult.html#MatMult">MatMult</A>(pcis-&gt;A_BI,pcis-&gt;vec2_D,pcis-&gt;vec1_B);
<a name="line1260">1260: </a>    <font color="#4169E1">if</font> (pcbddc-&gt;switch_static) { <A href="../../../../../docs/manualpages/Mat/MatMultAdd.html#MatMultAdd">MatMultAdd</A>(pcis-&gt;A_II,pcis-&gt;vec2_D,pcis-&gt;vec1_D,pcis-&gt;vec1_D); }
<a name="line1261">1261: </a>    <A href="../../../../../docs/manualpages/Vec/VecScale.html#VecScale">VecScale</A>(pcis-&gt;vec2_D,m_one);
<a name="line1262">1262: </a>    <A href="../../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</A>(r,z);
<a name="line1263">1263: </a>    <A href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</A>(pcis-&gt;global_to_B,pcis-&gt;vec1_B,z,<A href="../../../../../docs/manualpages/Sys/ADD_VALUES.html#ADD_VALUES">ADD_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</A>);
<a name="line1264">1264: </a>    <A href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</A>(pcis-&gt;global_to_B,pcis-&gt;vec1_B,z,<A href="../../../../../docs/manualpages/Sys/ADD_VALUES.html#ADD_VALUES">ADD_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</A>);
<a name="line1265">1265: </a>    PCBDDCScalingRestriction(pc,z,pcis-&gt;vec1_B);
<a name="line1266">1266: </a>  } <font color="#4169E1">else</font> {
<a name="line1267">1267: </a>    <A href="../../../../../docs/manualpages/Vec/VecSet.html#VecSet">VecSet</A>(pcis-&gt;vec1_D,zero);
<a name="line1268">1268: </a>    <A href="../../../../../docs/manualpages/Vec/VecSet.html#VecSet">VecSet</A>(pcis-&gt;vec2_D,zero);
<a name="line1269">1269: </a>    PCBDDCScalingRestriction(pc,r,pcis-&gt;vec1_B);
<a name="line1270">1270: </a>  }

<a name="line1272">1272: </a>  <font color="#B22222">/* Apply interface preconditioner</font>
<a name="line1273">1273: </a><font color="#B22222">     input/output vecs: pcis-&gt;vec1_B and pcis-&gt;vec1_D */</font>
<a name="line1274">1274: </a>  PCBDDCApplyInterfacePreconditioner(pc,<A href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</A>);

<a name="line1276">1276: </a>  <font color="#B22222">/* Apply transpose of partition of unity operator */</font>
<a name="line1277">1277: </a>  PCBDDCScalingExtension(pc,pcis-&gt;vec1_B,z);

<a name="line1279">1279: </a>  <font color="#B22222">/* Second Dirichlet solve and assembling of output */</font>
<a name="line1280">1280: </a>  <A href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</A>(pcis-&gt;global_to_B,z,pcis-&gt;vec1_B,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</A>);
<a name="line1281">1281: </a>  <A href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</A>(pcis-&gt;global_to_B,z,pcis-&gt;vec1_B,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</A>);
<a name="line1282">1282: </a>  <A href="../../../../../docs/manualpages/Mat/MatMult.html#MatMult">MatMult</A>(pcis-&gt;A_IB,pcis-&gt;vec1_B,pcis-&gt;vec3_D);
<a name="line1283">1283: </a>  <font color="#4169E1">if</font> (pcbddc-&gt;switch_static) { <A href="../../../../../docs/manualpages/Mat/MatMultAdd.html#MatMultAdd">MatMultAdd</A>(pcis-&gt;A_II,pcis-&gt;vec1_D,pcis-&gt;vec3_D,pcis-&gt;vec3_D); }
<a name="line1284">1284: </a>  <A href="../../../../../docs/manualpages/KSP/KSPSolve.html#KSPSolve">KSPSolve</A>(pcbddc-&gt;ksp_D,pcis-&gt;vec3_D,pcis-&gt;vec4_D);
<a name="line1285">1285: </a>  <A href="../../../../../docs/manualpages/Vec/VecScale.html#VecScale">VecScale</A>(pcis-&gt;vec4_D,m_one);
<a name="line1286">1286: </a>  <font color="#4169E1">if</font> (pcbddc-&gt;switch_static) { <A href="../../../../../docs/manualpages/Vec/VecAXPY.html#VecAXPY">VecAXPY</A>(pcis-&gt;vec4_D,one,pcis-&gt;vec1_D); }
<a name="line1287">1287: </a>  <A href="../../../../../docs/manualpages/Vec/VecAXPY.html#VecAXPY">VecAXPY</A>(pcis-&gt;vec2_D,one,pcis-&gt;vec4_D);
<a name="line1288">1288: </a>  <A href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</A>(pcis-&gt;global_to_D,pcis-&gt;vec2_D,z,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</A>);
<a name="line1289">1289: </a>  <A href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</A>(pcis-&gt;global_to_D,pcis-&gt;vec2_D,z,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</A>);
<a name="line1290">1290: </a>  <font color="#4169E1">return</font>(0);
<a name="line1291">1291: </a>}

<a name="line1293">1293: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>
<a name="line1294">1294: </a><font color="#B22222">/*</font>
<a name="line1295">1295: </a><font color="#B22222">   PCApplyTranspose_BDDC - Applies the transpose of the BDDC operator to a vector.</font>

<a name="line1297">1297: </a><font color="#B22222">   Input Parameters:</font>
<a name="line1298">1298: </a><font color="#B22222">.  pc - the preconditioner context</font>
<a name="line1299">1299: </a><font color="#B22222">.  r - input vector (global)</font>

<a name="line1301">1301: </a><font color="#B22222">   Output Parameter:</font>
<a name="line1302">1302: </a><font color="#B22222">.  z - output vector (global)</font>

<a name="line1304">1304: </a><font color="#B22222">   Application Interface Routine: <A href="../../../../../docs/manualpages/PC/PCApplyTranspose.html#PCApplyTranspose">PCApplyTranspose</A>()</font>
<a name="line1305">1305: </a><font color="#B22222"> */</font>
<a name="line1308">1308: </a><strong><font color="#4169E1"><a name="PCApplyTranspose_BDDC"></a><A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCApplyTranspose_BDDC(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc,<A href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</A> r,<A href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</A> z)</font></strong>
<a name="line1309">1309: </a>{
<a name="line1310">1310: </a>  PC_IS             *pcis = (PC_IS*)(pc-&gt;data);
<a name="line1311">1311: </a>  PC_BDDC           *pcbddc = (PC_BDDC*)(pc-&gt;data);
<a name="line1312">1312: </a>  <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A>    ierr;
<a name="line1313">1313: </a>  const <A href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</A> one = 1.0;
<a name="line1314">1314: </a>  const <A href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</A> m_one = -1.0;
<a name="line1315">1315: </a>  const <A href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</A> zero = 0.0;

<a name="line1318">1318: </a>  <font color="#4169E1">if</font> (!pcbddc-&gt;use_exact_dirichlet_trick) {
<a name="line1319">1319: </a>    <font color="#B22222">/* First Dirichlet solve */</font>
<a name="line1320">1320: </a>    <A href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</A>(pcis-&gt;global_to_D,r,pcis-&gt;vec1_D,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</A>);
<a name="line1321">1321: </a>    <A href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</A>(pcis-&gt;global_to_D,r,pcis-&gt;vec1_D,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</A>);
<a name="line1322">1322: </a>    <A href="../../../../../docs/manualpages/KSP/KSPSolveTranspose.html#KSPSolveTranspose">KSPSolveTranspose</A>(pcbddc-&gt;ksp_D,pcis-&gt;vec1_D,pcis-&gt;vec2_D);
<a name="line1323">1323: </a>    <font color="#B22222">/*</font>
<a name="line1324">1324: </a><font color="#B22222">      Assembling right hand side for BDDC operator</font>
<a name="line1325">1325: </a><font color="#B22222">      - pcis-&gt;vec1_D for the Dirichlet part (if needed, i.e. prec_flag=<A href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</A>)</font>
<a name="line1326">1326: </a><font color="#B22222">      - pcis-&gt;vec1_B the interface part of the global vector z</font>
<a name="line1327">1327: </a><font color="#B22222">    */</font>
<a name="line1328">1328: </a>    <A href="../../../../../docs/manualpages/Vec/VecScale.html#VecScale">VecScale</A>(pcis-&gt;vec2_D,m_one);
<a name="line1329">1329: </a>    <A href="../../../../../docs/manualpages/Mat/MatMultTranspose.html#MatMultTranspose">MatMultTranspose</A>(pcis-&gt;A_IB,pcis-&gt;vec2_D,pcis-&gt;vec1_B);
<a name="line1330">1330: </a>    <font color="#4169E1">if</font> (pcbddc-&gt;switch_static) { <A href="../../../../../docs/manualpages/Mat/MatMultTransposeAdd.html#MatMultTransposeAdd">MatMultTransposeAdd</A>(pcis-&gt;A_II,pcis-&gt;vec2_D,pcis-&gt;vec1_D,pcis-&gt;vec1_D); }
<a name="line1331">1331: </a>    <A href="../../../../../docs/manualpages/Vec/VecScale.html#VecScale">VecScale</A>(pcis-&gt;vec2_D,m_one);
<a name="line1332">1332: </a>    <A href="../../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</A>(r,z);
<a name="line1333">1333: </a>    <A href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</A>(pcis-&gt;global_to_B,pcis-&gt;vec1_B,z,<A href="../../../../../docs/manualpages/Sys/ADD_VALUES.html#ADD_VALUES">ADD_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</A>);
<a name="line1334">1334: </a>    <A href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</A>(pcis-&gt;global_to_B,pcis-&gt;vec1_B,z,<A href="../../../../../docs/manualpages/Sys/ADD_VALUES.html#ADD_VALUES">ADD_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</A>);
<a name="line1335">1335: </a>    PCBDDCScalingRestriction(pc,z,pcis-&gt;vec1_B);
<a name="line1336">1336: </a>  } <font color="#4169E1">else</font> {
<a name="line1337">1337: </a>    <A href="../../../../../docs/manualpages/Vec/VecSet.html#VecSet">VecSet</A>(pcis-&gt;vec1_D,zero);
<a name="line1338">1338: </a>    <A href="../../../../../docs/manualpages/Vec/VecSet.html#VecSet">VecSet</A>(pcis-&gt;vec2_D,zero);
<a name="line1339">1339: </a>    PCBDDCScalingRestriction(pc,r,pcis-&gt;vec1_B);
<a name="line1340">1340: </a>  }

<a name="line1342">1342: </a>  <font color="#B22222">/* Apply interface preconditioner</font>
<a name="line1343">1343: </a><font color="#B22222">     input/output vecs: pcis-&gt;vec1_B and pcis-&gt;vec1_D */</font>
<a name="line1344">1344: </a>  PCBDDCApplyInterfacePreconditioner(pc,<A href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</A>);

<a name="line1346">1346: </a>  <font color="#B22222">/* Apply transpose of partition of unity operator */</font>
<a name="line1347">1347: </a>  PCBDDCScalingExtension(pc,pcis-&gt;vec1_B,z);

<a name="line1349">1349: </a>  <font color="#B22222">/* Second Dirichlet solve and assembling of output */</font>
<a name="line1350">1350: </a>  <A href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</A>(pcis-&gt;global_to_B,z,pcis-&gt;vec1_B,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</A>);
<a name="line1351">1351: </a>  <A href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</A>(pcis-&gt;global_to_B,z,pcis-&gt;vec1_B,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</A>);
<a name="line1352">1352: </a>  <A href="../../../../../docs/manualpages/Mat/MatMultTranspose.html#MatMultTranspose">MatMultTranspose</A>(pcis-&gt;A_BI,pcis-&gt;vec1_B,pcis-&gt;vec3_D);
<a name="line1353">1353: </a>  <font color="#4169E1">if</font> (pcbddc-&gt;switch_static) { <A href="../../../../../docs/manualpages/Mat/MatMultTransposeAdd.html#MatMultTransposeAdd">MatMultTransposeAdd</A>(pcis-&gt;A_II,pcis-&gt;vec1_D,pcis-&gt;vec3_D,pcis-&gt;vec3_D); }
<a name="line1354">1354: </a>  <A href="../../../../../docs/manualpages/KSP/KSPSolveTranspose.html#KSPSolveTranspose">KSPSolveTranspose</A>(pcbddc-&gt;ksp_D,pcis-&gt;vec3_D,pcis-&gt;vec4_D);
<a name="line1355">1355: </a>  <A href="../../../../../docs/manualpages/Vec/VecScale.html#VecScale">VecScale</A>(pcis-&gt;vec4_D,m_one);
<a name="line1356">1356: </a>  <font color="#4169E1">if</font> (pcbddc-&gt;switch_static) { <A href="../../../../../docs/manualpages/Vec/VecAXPY.html#VecAXPY">VecAXPY</A>(pcis-&gt;vec4_D,one,pcis-&gt;vec1_D); }
<a name="line1357">1357: </a>  <A href="../../../../../docs/manualpages/Vec/VecAXPY.html#VecAXPY">VecAXPY</A>(pcis-&gt;vec2_D,one,pcis-&gt;vec4_D);
<a name="line1358">1358: </a>  <A href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</A>(pcis-&gt;global_to_D,pcis-&gt;vec2_D,z,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</A>);
<a name="line1359">1359: </a>  <A href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</A>(pcis-&gt;global_to_D,pcis-&gt;vec2_D,z,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</A>);
<a name="line1360">1360: </a>  <font color="#4169E1">return</font>(0);
<a name="line1361">1361: </a>}
<a name="line1362">1362: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line1366">1366: </a><strong><font color="#4169E1"><a name="PCDestroy_BDDC"></a><A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCDestroy_BDDC(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc)</font></strong>
<a name="line1367">1367: </a>{
<a name="line1368">1368: </a>  PC_BDDC        *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line1372">1372: </a>  <font color="#B22222">/* free data created by PCIS */</font>
<a name="line1373">1373: </a>  PCISDestroy(pc);
<a name="line1374">1374: </a>  <font color="#B22222">/* free BDDC custom data  */</font>
<a name="line1375">1375: </a>  PCBDDCResetCustomization(pc);
<a name="line1376">1376: </a>  <font color="#B22222">/* destroy objects related to topography */</font>
<a name="line1377">1377: </a>  PCBDDCResetTopography(pc);
<a name="line1378">1378: </a>  <font color="#B22222">/* free allocated graph structure */</font>
<a name="line1379">1379: </a>  <A href="../../../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</A>(pcbddc-&gt;mat_graph);
<a name="line1380">1380: </a>  <font color="#B22222">/* free data for scaling operator */</font>
<a name="line1381">1381: </a>  PCBDDCScalingDestroy(pc);
<a name="line1382">1382: </a>  <font color="#B22222">/* free solvers stuff */</font>
<a name="line1383">1383: </a>  PCBDDCResetSolvers(pc);
<a name="line1384">1384: </a>  <font color="#B22222">/* free global vectors needed in presolve */</font>
<a name="line1385">1385: </a>  <A href="../../../../../docs/manualpages/Vec/VecDestroy.html#VecDestroy">VecDestroy</A>(&amp;pcbddc-&gt;temp_solution);
<a name="line1386">1386: </a>  <A href="../../../../../docs/manualpages/Vec/VecDestroy.html#VecDestroy">VecDestroy</A>(&amp;pcbddc-&gt;original_rhs);
<a name="line1387">1387: </a>  <A href="../../../../../docs/manualpages/IS/ISLocalToGlobalMappingDestroy.html#ISLocalToGlobalMappingDestroy">ISLocalToGlobalMappingDestroy</A>(&amp;pcbddc-&gt;BtoNmap);
<a name="line1388">1388: </a>  <font color="#B22222">/* remove functions */</font>
<a name="line1389">1389: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCSetChangeOfBasisLocalMat_C"</font>,NULL);
<a name="line1390">1390: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCSetPrimalVerticesLocalIS_C"</font>,NULL);
<a name="line1391">1391: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCSetCoarseningRatio_C"</font>,NULL);
<a name="line1392">1392: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCSetLevel_C"</font>,NULL);
<a name="line1393">1393: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCSetUseExactDirichlet_C"</font>,NULL);
<a name="line1394">1394: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCSetLevels_C"</font>,NULL);
<a name="line1395">1395: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCSetNullSpace_C"</font>,NULL);
<a name="line1396">1396: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCSetDirichletBoundaries_C"</font>,NULL);
<a name="line1397">1397: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCSetDirichletBoundariesLocal_C"</font>,NULL);
<a name="line1398">1398: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCSetNeumannBoundaries_C"</font>,NULL);
<a name="line1399">1399: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCSetNeumannBoundariesLocal_C"</font>,NULL);
<a name="line1400">1400: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCGetDirichletBoundaries_C"</font>,NULL);
<a name="line1401">1401: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCGetDirichletBoundariesLocal_C"</font>,NULL);
<a name="line1402">1402: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCGetNeumannBoundaries_C"</font>,NULL);
<a name="line1403">1403: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCGetNeumannBoundariesLocal_C"</font>,NULL);
<a name="line1404">1404: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCSetDofsSplitting_C"</font>,NULL);
<a name="line1405">1405: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCSetDofsSplittingLocal_C"</font>,NULL);
<a name="line1406">1406: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCSetLocalAdjacencyGraph_C"</font>,NULL);
<a name="line1407">1407: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCCreateFETIDPOperators_C"</font>,NULL);
<a name="line1408">1408: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCMatFETIDPGetRHS_C"</font>,NULL);
<a name="line1409">1409: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCMatFETIDPGetSolution_C"</font>,NULL);
<a name="line1410">1410: </a>  <font color="#B22222">/* Free the private data structure */</font>
<a name="line1411">1411: </a>  <A href="../../../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</A>(pc-&gt;data);
<a name="line1412">1412: </a>  <font color="#4169E1">return</font>(0);
<a name="line1413">1413: </a>}
<a name="line1414">1414: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line1418">1418: </a><strong><font color="#4169E1"><a name="PCBDDCMatFETIDPGetRHS_BDDC"></a>static <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCBDDCMatFETIDPGetRHS_BDDC(<A href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</A> fetidp_mat, <A href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</A> standard_rhs, <A href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</A> fetidp_flux_rhs)</font></strong>
<a name="line1419">1419: </a>{
<a name="line1420">1420: </a>  FETIDPMat_ctx  mat_ctx;
<a name="line1421">1421: </a>  PC_IS*         pcis;
<a name="line1422">1422: </a>  PC_BDDC*       pcbddc;

<a name="line1426">1426: </a>  <A href="../../../../../docs/manualpages/Mat/MatShellGetContext.html#MatShellGetContext">MatShellGetContext</A>(fetidp_mat,&amp;mat_ctx);
<a name="line1427">1427: </a>  pcis = (PC_IS*)mat_ctx-&gt;pc-&gt;data;
<a name="line1428">1428: </a>  pcbddc = (PC_BDDC*)mat_ctx-&gt;pc-&gt;data;

<a name="line1430">1430: </a>  <font color="#B22222">/* change of basis for physical rhs if needed</font>
<a name="line1431">1431: </a><font color="#B22222">     It also changes the rhs in case of dirichlet boundaries */</font>
<a name="line1432">1432: </a>  PCPreSolve_BDDC(mat_ctx-&gt;pc,NULL,standard_rhs,NULL);
<a name="line1433">1433: </a>  <font color="#B22222">/* store vectors for computation of fetidp final solution */</font>
<a name="line1434">1434: </a>  <A href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</A>(pcis-&gt;global_to_D,standard_rhs,mat_ctx-&gt;temp_solution_D,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</A>);
<a name="line1435">1435: </a>  <A href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</A>(pcis-&gt;global_to_D,standard_rhs,mat_ctx-&gt;temp_solution_D,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</A>);
<a name="line1436">1436: </a>  <font color="#B22222">/* scale rhs since it should be unassembled */</font>
<a name="line1437">1437: </a>  <font color="#B22222">/* TODO use counter scaling? (also below) */</font>
<a name="line1438">1438: </a>  <A href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</A>(pcis-&gt;global_to_B,standard_rhs,mat_ctx-&gt;temp_solution_B,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</A>);
<a name="line1439">1439: </a>  <A href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</A>(pcis-&gt;global_to_B,standard_rhs,mat_ctx-&gt;temp_solution_B,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</A>);
<a name="line1440">1440: </a>  <font color="#B22222">/* Apply partition of unity */</font>
<a name="line1441">1441: </a>  <A href="../../../../../docs/manualpages/Vec/VecPointwiseMult.html#VecPointwiseMult">VecPointwiseMult</A>(mat_ctx-&gt;temp_solution_B,pcis-&gt;D,mat_ctx-&gt;temp_solution_B);
<a name="line1442">1442: </a>  <font color="#B22222">/* PCBDDCScalingRestriction(mat_ctx-&gt;pc,standard_rhs,mat_ctx-&gt;temp_solution_B); */</font>
<a name="line1443">1443: </a>  <font color="#4169E1">if</font> (!pcbddc-&gt;switch_static) {
<a name="line1444">1444: </a>    <font color="#B22222">/* compute partially subassembled Schur complement right-hand side */</font>
<a name="line1445">1445: </a>    <A href="../../../../../docs/manualpages/KSP/KSPSolve.html#KSPSolve">KSPSolve</A>(pcbddc-&gt;ksp_D,mat_ctx-&gt;temp_solution_D,pcis-&gt;vec1_D);
<a name="line1446">1446: </a>    <A href="../../../../../docs/manualpages/Mat/MatMult.html#MatMult">MatMult</A>(pcis-&gt;A_BI,pcis-&gt;vec1_D,pcis-&gt;vec1_B);
<a name="line1447">1447: </a>    <A href="../../../../../docs/manualpages/Vec/VecAXPY.html#VecAXPY">VecAXPY</A>(mat_ctx-&gt;temp_solution_B,-1.0,pcis-&gt;vec1_B);
<a name="line1448">1448: </a>    <A href="../../../../../docs/manualpages/Vec/VecSet.html#VecSet">VecSet</A>(standard_rhs,0.0);
<a name="line1449">1449: </a>    <A href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</A>(pcis-&gt;global_to_B,mat_ctx-&gt;temp_solution_B,standard_rhs,<A href="../../../../../docs/manualpages/Sys/ADD_VALUES.html#ADD_VALUES">ADD_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</A>);
<a name="line1450">1450: </a>    <A href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</A>(pcis-&gt;global_to_B,mat_ctx-&gt;temp_solution_B,standard_rhs,<A href="../../../../../docs/manualpages/Sys/ADD_VALUES.html#ADD_VALUES">ADD_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</A>);
<a name="line1451">1451: </a>    <font color="#B22222">/* PCBDDCScalingRestriction(mat_ctx-&gt;pc,standard_rhs,mat_ctx-&gt;temp_solution_B); */</font>
<a name="line1452">1452: </a>    <A href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</A>(pcis-&gt;global_to_B,standard_rhs,mat_ctx-&gt;temp_solution_B,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</A>);
<a name="line1453">1453: </a>    <A href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</A>(pcis-&gt;global_to_B,standard_rhs,mat_ctx-&gt;temp_solution_B,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</A>);
<a name="line1454">1454: </a>    <A href="../../../../../docs/manualpages/Vec/VecPointwiseMult.html#VecPointwiseMult">VecPointwiseMult</A>(mat_ctx-&gt;temp_solution_B,pcis-&gt;D,mat_ctx-&gt;temp_solution_B);
<a name="line1455">1455: </a>  }
<a name="line1456">1456: </a>  <font color="#B22222">/* BDDC rhs */</font>
<a name="line1457">1457: </a>  <A href="../../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</A>(mat_ctx-&gt;temp_solution_B,pcis-&gt;vec1_B);
<a name="line1458">1458: </a>  <font color="#4169E1">if</font> (pcbddc-&gt;switch_static) {
<a name="line1459">1459: </a>    <A href="../../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</A>(mat_ctx-&gt;temp_solution_D,pcis-&gt;vec1_D);
<a name="line1460">1460: </a>  }
<a name="line1461">1461: </a>  <font color="#B22222">/* apply BDDC */</font>
<a name="line1462">1462: </a>  PCBDDCApplyInterfacePreconditioner(mat_ctx-&gt;pc,<A href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</A>);
<a name="line1463">1463: </a>  <font color="#B22222">/* Application of B_delta and assembling of rhs for fetidp fluxes */</font>
<a name="line1464">1464: </a>  <A href="../../../../../docs/manualpages/Vec/VecSet.html#VecSet">VecSet</A>(fetidp_flux_rhs,0.0);
<a name="line1465">1465: </a>  <A href="../../../../../docs/manualpages/Mat/MatMult.html#MatMult">MatMult</A>(mat_ctx-&gt;B_delta,pcis-&gt;vec1_B,mat_ctx-&gt;lambda_local);
<a name="line1466">1466: </a>  <A href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</A>(mat_ctx-&gt;l2g_lambda,mat_ctx-&gt;lambda_local,fetidp_flux_rhs,<A href="../../../../../docs/manualpages/Sys/ADD_VALUES.html#ADD_VALUES">ADD_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</A>);
<a name="line1467">1467: </a>  <A href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</A>  (mat_ctx-&gt;l2g_lambda,mat_ctx-&gt;lambda_local,fetidp_flux_rhs,<A href="../../../../../docs/manualpages/Sys/ADD_VALUES.html#ADD_VALUES">ADD_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</A>);
<a name="line1468">1468: </a>  <font color="#B22222">/* restore original rhs */</font>
<a name="line1469">1469: </a>  <A href="../../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</A>(pcbddc-&gt;original_rhs,standard_rhs);
<a name="line1470">1470: </a>  <font color="#4169E1">return</font>(0);
<a name="line1471">1471: </a>}

<a name="line1475">1475: </a><font color="#B22222">/*@</font>
<a name="line1476">1476: </a><font color="#B22222"> <A href="../../../../../docs/manualpages/PC/PCBDDCMatFETIDPGetRHS.html#PCBDDCMatFETIDPGetRHS">PCBDDCMatFETIDPGetRHS</A> - Compute the right-hand side for FETIDP linear system</font>

<a name="line1478">1478: </a><font color="#B22222">   Collective</font>

<a name="line1480">1480: </a><font color="#B22222">   Input Parameters:</font>
<a name="line1481">1481: </a><font color="#B22222">+  fetidp_mat   - the FETIDP matrix object obtained by calling <A href="../../../../../docs/manualpages/PC/PCBDDCCreateFETIDPOperators.html#PCBDDCCreateFETIDPOperators">PCBDDCCreateFETIDPOperators</A></font>
<a name="line1482">1482: </a><font color="#B22222">.  standard_rhs - the right-hand side for your linear system</font>

<a name="line1484">1484: </a><font color="#B22222">   Output Parameters:</font>
<a name="line1485">1485: </a><font color="#B22222">-  fetidp_flux_rhs   - the right-hand side for the FETIDP linear system</font>

<a name="line1487">1487: </a><font color="#B22222">   Level: developer</font>

<a name="line1489">1489: </a><font color="#B22222">   Notes:</font>

<a name="line1491">1491: </a><font color="#B22222">.seealso: <A href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</A>,<A href="../../../../../docs/manualpages/PC/PCBDDCCreateFETIDPOperators.html#PCBDDCCreateFETIDPOperators">PCBDDCCreateFETIDPOperators</A></font>
<a name="line1492">1492: </a><font color="#B22222">@*/</font>
<a name="line1493">1493: </a><strong><font color="#4169E1"><a name="PCBDDCMatFETIDPGetRHS"></a><A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> <A href="../../../../../docs/manualpages/PC/PCBDDCMatFETIDPGetRHS.html#PCBDDCMatFETIDPGetRHS">PCBDDCMatFETIDPGetRHS</A>(<A href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</A> fetidp_mat, <A href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</A> standard_rhs, <A href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</A> fetidp_flux_rhs)</font></strong>
<a name="line1494">1494: </a>{
<a name="line1495">1495: </a>  FETIDPMat_ctx  mat_ctx;

<a name="line1499">1499: </a>  <A href="../../../../../docs/manualpages/Mat/MatShellGetContext.html#MatShellGetContext">MatShellGetContext</A>(fetidp_mat,&amp;mat_ctx);
<a name="line1500">1500: </a>  PetscTryMethod(mat_ctx-&gt;pc,<font color="#666666">"PCBDDCMatFETIDPGetRHS_C"</font>,(<A href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</A>,<A href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</A>,<A href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</A>),(fetidp_mat,standard_rhs,fetidp_flux_rhs));
<a name="line1501">1501: </a>  <font color="#4169E1">return</font>(0);
<a name="line1502">1502: </a>}
<a name="line1503">1503: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line1507">1507: </a><strong><font color="#4169E1"><a name="PCBDDCMatFETIDPGetSolution_BDDC"></a>static <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCBDDCMatFETIDPGetSolution_BDDC(<A href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</A> fetidp_mat, <A href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</A> fetidp_flux_sol, <A href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</A> standard_sol)</font></strong>
<a name="line1508">1508: </a>{
<a name="line1509">1509: </a>  FETIDPMat_ctx  mat_ctx;
<a name="line1510">1510: </a>  PC_IS*         pcis;
<a name="line1511">1511: </a>  PC_BDDC*       pcbddc;

<a name="line1515">1515: </a>  <A href="../../../../../docs/manualpages/Mat/MatShellGetContext.html#MatShellGetContext">MatShellGetContext</A>(fetidp_mat,&amp;mat_ctx);
<a name="line1516">1516: </a>  pcis = (PC_IS*)mat_ctx-&gt;pc-&gt;data;
<a name="line1517">1517: </a>  pcbddc = (PC_BDDC*)mat_ctx-&gt;pc-&gt;data;

<a name="line1519">1519: </a>  <font color="#B22222">/* apply B_delta^T */</font>
<a name="line1520">1520: </a>  <A href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</A>(mat_ctx-&gt;l2g_lambda,fetidp_flux_sol,mat_ctx-&gt;lambda_local,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</A>);
<a name="line1521">1521: </a>  <A href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</A>  (mat_ctx-&gt;l2g_lambda,fetidp_flux_sol,mat_ctx-&gt;lambda_local,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</A>);
<a name="line1522">1522: </a>  <A href="../../../../../docs/manualpages/Mat/MatMultTranspose.html#MatMultTranspose">MatMultTranspose</A>(mat_ctx-&gt;B_delta,mat_ctx-&gt;lambda_local,pcis-&gt;vec1_B);
<a name="line1523">1523: </a>  <font color="#B22222">/* compute rhs for BDDC application */</font>
<a name="line1524">1524: </a>  <A href="../../../../../docs/manualpages/Vec/VecAYPX.html#VecAYPX">VecAYPX</A>(pcis-&gt;vec1_B,-1.0,mat_ctx-&gt;temp_solution_B);
<a name="line1525">1525: </a>  <font color="#4169E1">if</font> (pcbddc-&gt;switch_static) {
<a name="line1526">1526: </a>    <A href="../../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</A>(mat_ctx-&gt;temp_solution_D,pcis-&gt;vec1_D);
<a name="line1527">1527: </a>  }
<a name="line1528">1528: </a>  <font color="#B22222">/* apply BDDC */</font>
<a name="line1529">1529: </a>  PCBDDCApplyInterfacePreconditioner(mat_ctx-&gt;pc,<A href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</A>);
<a name="line1530">1530: </a>  <font color="#B22222">/* put values into standard global vector */</font>
<a name="line1531">1531: </a>  <A href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</A>(pcis-&gt;global_to_B,pcis-&gt;vec1_B,standard_sol,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</A>);
<a name="line1532">1532: </a>  <A href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</A>  (pcis-&gt;global_to_B,pcis-&gt;vec1_B,standard_sol,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</A>);
<a name="line1533">1533: </a>  <font color="#4169E1">if</font> (!pcbddc-&gt;switch_static) {
<a name="line1534">1534: </a>    <font color="#B22222">/* compute values into the interior if solved for the partially subassembled Schur complement */</font>
<a name="line1535">1535: </a>    <A href="../../../../../docs/manualpages/Mat/MatMult.html#MatMult">MatMult</A>(pcis-&gt;A_IB,pcis-&gt;vec1_B,pcis-&gt;vec1_D);
<a name="line1536">1536: </a>    <A href="../../../../../docs/manualpages/Vec/VecAXPY.html#VecAXPY">VecAXPY</A>(mat_ctx-&gt;temp_solution_D,-1.0,pcis-&gt;vec1_D);
<a name="line1537">1537: </a>    <A href="../../../../../docs/manualpages/KSP/KSPSolve.html#KSPSolve">KSPSolve</A>(pcbddc-&gt;ksp_D,mat_ctx-&gt;temp_solution_D,pcis-&gt;vec1_D);
<a name="line1538">1538: </a>  }
<a name="line1539">1539: </a>  <A href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</A>(pcis-&gt;global_to_D,pcis-&gt;vec1_D,standard_sol,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</A>);
<a name="line1540">1540: </a>  <A href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</A>  (pcis-&gt;global_to_D,pcis-&gt;vec1_D,standard_sol,<A href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</A>,<A href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</A>);
<a name="line1541">1541: </a>  <font color="#B22222">/* final change of basis if needed</font>
<a name="line1542">1542: </a><font color="#B22222">     Is also sums the dirichlet part removed during RHS assembling */</font>
<a name="line1543">1543: </a>  PCPostSolve_BDDC(mat_ctx-&gt;pc,NULL,NULL,standard_sol);
<a name="line1544">1544: </a>  <font color="#4169E1">return</font>(0);
<a name="line1545">1545: </a>}

<a name="line1549">1549: </a><font color="#B22222">/*@</font>
<a name="line1550">1550: </a><font color="#B22222"> <A href="../../../../../docs/manualpages/PC/PCBDDCMatFETIDPGetSolution.html#PCBDDCMatFETIDPGetSolution">PCBDDCMatFETIDPGetSolution</A> - Compute the physical solution from the solution of the FETIDP linear system</font>

<a name="line1552">1552: </a><font color="#B22222">   Collective</font>

<a name="line1554">1554: </a><font color="#B22222">   Input Parameters:</font>
<a name="line1555">1555: </a><font color="#B22222">+  fetidp_mat        - the FETIDP matrix obtained by calling <A href="../../../../../docs/manualpages/PC/PCBDDCCreateFETIDPOperators.html#PCBDDCCreateFETIDPOperators">PCBDDCCreateFETIDPOperators</A></font>
<a name="line1556">1556: </a><font color="#B22222">.  fetidp_flux_sol - the solution of the FETIDP linear system</font>

<a name="line1558">1558: </a><font color="#B22222">   Output Parameters:</font>
<a name="line1559">1559: </a><font color="#B22222">-  standard_sol      - the solution defined on the physical domain</font>

<a name="line1561">1561: </a><font color="#B22222">   Level: developer</font>

<a name="line1563">1563: </a><font color="#B22222">   Notes:</font>

<a name="line1565">1565: </a><font color="#B22222">.seealso: <A href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</A>,<A href="../../../../../docs/manualpages/PC/PCBDDCCreateFETIDPOperators.html#PCBDDCCreateFETIDPOperators">PCBDDCCreateFETIDPOperators</A></font>
<a name="line1566">1566: </a><font color="#B22222">@*/</font>
<a name="line1567">1567: </a><strong><font color="#4169E1"><a name="PCBDDCMatFETIDPGetSolution"></a><A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> <A href="../../../../../docs/manualpages/PC/PCBDDCMatFETIDPGetSolution.html#PCBDDCMatFETIDPGetSolution">PCBDDCMatFETIDPGetSolution</A>(<A href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</A> fetidp_mat, <A href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</A> fetidp_flux_sol, <A href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</A> standard_sol)</font></strong>
<a name="line1568">1568: </a>{
<a name="line1569">1569: </a>  FETIDPMat_ctx  mat_ctx;

<a name="line1573">1573: </a>  <A href="../../../../../docs/manualpages/Mat/MatShellGetContext.html#MatShellGetContext">MatShellGetContext</A>(fetidp_mat,&amp;mat_ctx);
<a name="line1574">1574: </a>  PetscTryMethod(mat_ctx-&gt;pc,<font color="#666666">"PCBDDCMatFETIDPGetSolution_C"</font>,(<A href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</A>,<A href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</A>,<A href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</A>),(fetidp_mat,fetidp_flux_sol,standard_sol));
<a name="line1575">1575: </a>  <font color="#4169E1">return</font>(0);
<a name="line1576">1576: </a>}
<a name="line1577">1577: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line1579">1579: </a><strong><font color="#4169E1">extern <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> FETIDPMatMult(<A href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</A>,<A href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</A>,<A href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</A>)</font></strong>;
<a name="line1580">1580: </a><strong><font color="#4169E1">extern <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> FETIDPMatMultTranspose(<A href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</A>,<A href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</A>,<A href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</A>)</font></strong>;
<a name="line1581">1581: </a><strong><font color="#4169E1">extern <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCBDDCDestroyFETIDPMat(<A href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</A>)</font></strong>;
<a name="line1582">1582: </a><strong><font color="#4169E1">extern <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> FETIDPPCApply(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A>,<A href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</A>,<A href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</A>)</font></strong>;
<a name="line1583">1583: </a><strong><font color="#4169E1">extern <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> FETIDPPCApplyTranspose(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A>,<A href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</A>,<A href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</A>)</font></strong>;
<a name="line1584">1584: </a><strong><font color="#4169E1">extern <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCBDDCDestroyFETIDPPC(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A>)</font></strong>;

<a name="line1588">1588: </a><strong><font color="#4169E1"><a name="PCBDDCCreateFETIDPOperators_BDDC"></a>static <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCBDDCCreateFETIDPOperators_BDDC(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc, <A href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</A> *fetidp_mat, <A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> *fetidp_pc)</font></strong>
<a name="line1589">1589: </a>{

<a name="line1591">1591: </a>  FETIDPMat_ctx  fetidpmat_ctx;
<a name="line1592">1592: </a>  <A href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</A>            newmat;
<a name="line1593">1593: </a>  FETIDPPC_ctx   fetidppc_ctx;
<a name="line1594">1594: </a>  <A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A>             newpc;
<a name="line1595">1595: </a>  <A href="../../../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</A>       comm;

<a name="line1599">1599: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectGetComm.html#PetscObjectGetComm">PetscObjectGetComm</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,&amp;comm);
<a name="line1600">1600: </a>  <font color="#B22222">/* FETIDP linear matrix */</font>
<a name="line1601">1601: </a>  PCBDDCCreateFETIDPMatContext(pc,&amp;fetidpmat_ctx);
<a name="line1602">1602: </a>  PCBDDCSetupFETIDPMatContext(fetidpmat_ctx);
<a name="line1603">1603: </a>  <A href="../../../../../docs/manualpages/Mat/MatCreateShell.html#MatCreateShell">MatCreateShell</A>(comm,<A href="../../../../../docs/manualpages/Sys/PETSC_DECIDE.html#PETSC_DECIDE">PETSC_DECIDE</A>,<A href="../../../../../docs/manualpages/Sys/PETSC_DECIDE.html#PETSC_DECIDE">PETSC_DECIDE</A>,fetidpmat_ctx-&gt;n_lambda,fetidpmat_ctx-&gt;n_lambda,fetidpmat_ctx,&amp;newmat);
<a name="line1604">1604: </a>  <A href="../../../../../docs/manualpages/Mat/MatShellSetOperation.html#MatShellSetOperation">MatShellSetOperation</A>(newmat,MATOP_MULT,(void (*)(void))FETIDPMatMult);
<a name="line1605">1605: </a>  <A href="../../../../../docs/manualpages/Mat/MatShellSetOperation.html#MatShellSetOperation">MatShellSetOperation</A>(newmat,MATOP_MULT_TRANSPOSE,(void (*)(void))FETIDPMatMultTranspose);
<a name="line1606">1606: </a>  <A href="../../../../../docs/manualpages/Mat/MatShellSetOperation.html#MatShellSetOperation">MatShellSetOperation</A>(newmat,MATOP_DESTROY,(void (*)(void))PCBDDCDestroyFETIDPMat);
<a name="line1607">1607: </a>  <A href="../../../../../docs/manualpages/Mat/MatSetUp.html#MatSetUp">MatSetUp</A>(newmat);
<a name="line1608">1608: </a>  <font color="#B22222">/* FETIDP preconditioner */</font>
<a name="line1609">1609: </a>  PCBDDCCreateFETIDPPCContext(pc,&amp;fetidppc_ctx);
<a name="line1610">1610: </a>  PCBDDCSetupFETIDPPCContext(newmat,fetidppc_ctx);
<a name="line1611">1611: </a>  <A href="../../../../../docs/manualpages/PC/PCCreate.html#PCCreate">PCCreate</A>(comm,&amp;newpc);
<a name="line1612">1612: </a>  <A href="../../../../../docs/manualpages/PC/PCSetType.html#PCSetType">PCSetType</A>(newpc,<A href="../../../../../docs/manualpages/PC/PCSHELL.html#PCSHELL">PCSHELL</A>);
<a name="line1613">1613: </a>  <A href="../../../../../docs/manualpages/PC/PCShellSetContext.html#PCShellSetContext">PCShellSetContext</A>(newpc,fetidppc_ctx);
<a name="line1614">1614: </a>  <A href="../../../../../docs/manualpages/PC/PCShellSetApply.html#PCShellSetApply">PCShellSetApply</A>(newpc,FETIDPPCApply);
<a name="line1615">1615: </a>  <A href="../../../../../docs/manualpages/PC/PCShellSetApplyTranspose.html#PCShellSetApplyTranspose">PCShellSetApplyTranspose</A>(newpc,FETIDPPCApplyTranspose);
<a name="line1616">1616: </a>  <A href="../../../../../docs/manualpages/PC/PCShellSetDestroy.html#PCShellSetDestroy">PCShellSetDestroy</A>(newpc,PCBDDCDestroyFETIDPPC);
<a name="line1617">1617: </a>  <A href="../../../../../docs/manualpages/PC/PCSetOperators.html#PCSetOperators">PCSetOperators</A>(newpc,newmat,newmat);
<a name="line1618">1618: </a>  <A href="../../../../../docs/manualpages/PC/PCSetUp.html#PCSetUp">PCSetUp</A>(newpc);
<a name="line1619">1619: </a>  <font color="#B22222">/* return pointers for objects created */</font>
<a name="line1620">1620: </a>  *fetidp_mat=newmat;
<a name="line1621">1621: </a>  *fetidp_pc=newpc;
<a name="line1622">1622: </a>  <font color="#4169E1">return</font>(0);
<a name="line1623">1623: </a>}

<a name="line1627">1627: </a><font color="#B22222">/*@</font>
<a name="line1628">1628: </a><font color="#B22222"> <A href="../../../../../docs/manualpages/PC/PCBDDCCreateFETIDPOperators.html#PCBDDCCreateFETIDPOperators">PCBDDCCreateFETIDPOperators</A> - Create operators for FETIDP</font>

<a name="line1630">1630: </a><font color="#B22222">   Collective</font>

<a name="line1632">1632: </a><font color="#B22222">   Input Parameters:</font>
<a name="line1633">1633: </a><font color="#B22222">+  pc - the BDDC preconditioning context already setup</font>

<a name="line1635">1635: </a><font color="#B22222">   Output Parameters:</font>
<a name="line1636">1636: </a><font color="#B22222">.  fetidp_mat - shell FETIDP matrix object</font>
<a name="line1637">1637: </a><font color="#B22222">.  fetidp_pc  - shell Dirichlet preconditioner for FETIDP matrix</font>

<a name="line1639">1639: </a><font color="#B22222">   Options Database Keys:</font>
<a name="line1640">1640: </a><font color="#B22222">-    -fetidp_fullyredundant: use or not a fully redundant set of Lagrange multipliers</font>

<a name="line1642">1642: </a><font color="#B22222">   Level: developer</font>

<a name="line1644">1644: </a><font color="#B22222">   Notes:</font>
<a name="line1645">1645: </a><font color="#B22222">     Currently the only operation provided for FETIDP matrix is <A href="../../../../../docs/manualpages/Mat/MatMult.html#MatMult">MatMult</A></font>

<a name="line1647">1647: </a><font color="#B22222">.seealso: <A href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</A></font>
<a name="line1648">1648: </a><font color="#B22222">@*/</font>
<a name="line1649">1649: </a><strong><font color="#4169E1"><a name="PCBDDCCreateFETIDPOperators"></a><A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> <A href="../../../../../docs/manualpages/PC/PCBDDCCreateFETIDPOperators.html#PCBDDCCreateFETIDPOperators">PCBDDCCreateFETIDPOperators</A>(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc, <A href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</A> *fetidp_mat, <A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> *fetidp_pc)</font></strong>
<a name="line1650">1650: </a>{

<a name="line1655">1655: </a>  <font color="#4169E1">if</font> (pc-&gt;setupcalled) {
<a name="line1656">1656: </a>    PetscUseMethod(pc,<font color="#666666">"PCBDDCCreateFETIDPOperators_C"</font>,(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A>,<A href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</A>*,<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A>*),(pc,fetidp_mat,fetidp_pc));
<a name="line1657">1657: </a>  } <font color="#4169E1">else</font> <A href="../../../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</A>(<A href="../../../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</A>,PETSC_ERR_SUP,<font color="#666666">"You must call PCSetup_BDDC() first \n"</font>);
<a name="line1658">1658: </a>  <font color="#4169E1">return</font>(0);
<a name="line1659">1659: </a>}
<a name="line1660">1660: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>
<a name="line1661">1661: </a><font color="#B22222">/*MC</font>
<a name="line1662">1662: </a><font color="#B22222">   <A href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</A> - Balancing Domain Decomposition by Constraints.</font>

<a name="line1664">1664: </a><font color="#B22222">   An implementation of the BDDC preconditioner based on</font>

<a name="line1666">1666: </a><font color="#B22222">.vb</font>
<a name="line1667">1667: </a><font color="#B22222">   [1] C. R. Dohrmann. "An approximate BDDC preconditioner", Numerical Linear Algebra with Applications Volume 14, Issue 2, pages 149-168, March 2007</font>
<a name="line1668">1668: </a><font color="#B22222">   [2] A. Klawonn and O. B. Widlund. "Dual-Primal FETI Methods for Linear Elasticity", http://cs.nyu.edu/csweb/Research/TechReports/TR2004-855/TR2004-855.pdf</font>
<a name="line1669">1669: </a><font color="#B22222">   [3] J. Mandel, B. Sousedik, C. R. Dohrmann. "Multispace and Multilevel BDDC", http://arxiv.org/abs/0712.3977</font>
<a name="line1670">1670: </a><font color="#B22222">.ve</font>

<a name="line1672">1672: </a><font color="#B22222">   The matrix to be preconditioned (Pmat) must be of type <A href="../../../../../docs/manualpages/Mat/MATIS.html#MATIS">MATIS</A>.</font>

<a name="line1674">1674: </a><font color="#B22222">   Currently works with <A href="../../../../../docs/manualpages/Mat/MATIS.html#MATIS">MATIS</A> matrices with local Neumann matrices of type <A href="../../../../../docs/manualpages/Mat/MATSEQAIJ.html#MATSEQAIJ">MATSEQAIJ</A>, <A href="../../../../../docs/manualpages/Mat/MATSEQBAIJ.html#MATSEQBAIJ">MATSEQBAIJ</A> or <A href="../../../../../docs/manualpages/Mat/MATSEQSBAIJ.html#MATSEQSBAIJ">MATSEQSBAIJ</A>, either with real or complex numbers.</font>

<a name="line1676">1676: </a><font color="#B22222">   It also works with unsymmetric and indefinite problems.</font>

<a name="line1678">1678: </a><font color="#B22222">   Unlike 'conventional' interface preconditioners, <A href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</A> iterates over all degrees of freedom, not just those on the interface. This allows the use of approximate solvers on the subdomains.</font>

<a name="line1680">1680: </a><font color="#B22222">   Approximate local solvers are automatically adapted for singular linear problems (see [1]) if the user has provided the nullspace using <A href="../../../../../docs/manualpages/PC/PCBDDCSetNullSpace.html#PCBDDCSetNullSpace">PCBDDCSetNullSpace</A></font>

<a name="line1682">1682: </a><font color="#B22222">   Boundary nodes are split in vertices, edges and faces using information from the local to global mapping of dofs and the local connectivity graph of nodes. The latter can be customized by using <A href="../../../../../docs/manualpages/PC/PCBDDCSetLocalAdjacencyGraph.html#PCBDDCSetLocalAdjacencyGraph">PCBDDCSetLocalAdjacencyGraph</A>()</font>

<a name="line1684">1684: </a><font color="#B22222">   Constraints can be customized by attaching a <A href="../../../../../docs/manualpages/Mat/MatNullSpace.html#MatNullSpace">MatNullSpace</A> object to the <A href="../../../../../docs/manualpages/Mat/MATIS.html#MATIS">MATIS</A> matrix via <A href="../../../../../docs/manualpages/Mat/MatSetNearNullSpace.html#MatSetNearNullSpace">MatSetNearNullSpace</A>().</font>

<a name="line1686">1686: </a><font color="#B22222">   Change of basis is performed similarly to [2] when requested. When more the one constraint is present on a single connected component (i.e. an edge or a face), a robust method based on local QR factorizations is used.</font>

<a name="line1688">1688: </a><font color="#B22222">   The PETSc implementation also supports multilevel BDDC [3]. Coarse grids are partitioned using <A href="../../../../../docs/manualpages/Mat/MatPartitioning.html#MatPartitioning">MatPartitioning</A> object.</font>

<a name="line1690">1690: </a><font color="#B22222">   Options Database Keys:</font>

<a name="line1692">1692: </a><font color="#B22222">.    -pc_bddc_use_vertices &lt;1&gt; - use or not vertices in primal space</font>
<a name="line1693">1693: </a><font color="#B22222">.    -pc_bddc_use_edges &lt;1&gt; - use or not edges in primal space</font>
<a name="line1694">1694: </a><font color="#B22222">.    -pc_bddc_use_faces &lt;0&gt; - use or not faces in primal space</font>
<a name="line1695">1695: </a><font color="#B22222">.    -pc_bddc_use_change_of_basis &lt;0&gt; - use change of basis approach (on edges only)</font>
<a name="line1696">1696: </a><font color="#B22222">.    -pc_bddc_use_change_on_faces &lt;0&gt; - use change of basis approach on faces if change of basis has been requested</font>
<a name="line1697">1697: </a><font color="#B22222">.    -pc_bddc_switch_static &lt;0&gt; - switches from M_2 to M_3 operator (see reference article [1])</font>
<a name="line1698">1698: </a><font color="#B22222">.    -pc_bddc_levels &lt;0&gt; - maximum number of levels for multilevel</font>
<a name="line1699">1699: </a><font color="#B22222">.    -pc_bddc_coarsening_ratio - H/h ratio at the coarser level</font>
<a name="line1700">1700: </a><font color="#B22222">-    -pc_bddc_check_level &lt;0&gt; - set verbosity level of debugging output</font>

<a name="line1702">1702: </a><font color="#B22222">   Options for Dirichlet, Neumann or coarse solver can be set with</font>
<a name="line1703">1703: </a><font color="#B22222">.vb</font>
<a name="line1704">1704: </a><font color="#B22222">      -pc_bddc_dirichlet_</font>
<a name="line1705">1705: </a><font color="#B22222">      -pc_bddc_neumann_</font>
<a name="line1706">1706: </a><font color="#B22222">      -pc_bddc_coarse_</font>
<a name="line1707">1707: </a><font color="#B22222">.ve</font>
<a name="line1708">1708: </a><font color="#B22222">   e.g -pc_bddc_dirichlet_ksp_type richardson -pc_bddc_dirichlet_pc_type gamg</font>

<a name="line1710">1710: </a><font color="#B22222">   When using a multilevel approach, solvers' options at the N-th level can be specified as</font>
<a name="line1711">1711: </a><font color="#B22222">.vb</font>
<a name="line1712">1712: </a><font color="#B22222">      -pc_bddc_dirichlet_lN_</font>
<a name="line1713">1713: </a><font color="#B22222">      -pc_bddc_neumann_lN_</font>
<a name="line1714">1714: </a><font color="#B22222">      -pc_bddc_coarse_lN_</font>
<a name="line1715">1715: </a><font color="#B22222">.ve</font>
<a name="line1716">1716: </a><font color="#B22222">   Note that level number ranges from the finest 0 to the coarsest N.</font>

<a name="line1718">1718: </a><font color="#B22222">   Level: intermediate</font>

<a name="line1720">1720: </a><font color="#B22222">   Developer notes:</font>

<a name="line1722">1722: </a><font color="#B22222">   New deluxe scaling operator will be available soon.</font>

<a name="line1724">1724: </a><font color="#B22222">   Contributed by Stefano Zampini</font>

<a name="line1726">1726: </a><font color="#B22222">.seealso:  <A href="../../../../../docs/manualpages/PC/PCCreate.html#PCCreate">PCCreate</A>(), <A href="../../../../../docs/manualpages/PC/PCSetType.html#PCSetType">PCSetType</A>(), <A href="../../../../../docs/manualpages/PC/PCType.html#PCType">PCType</A> (for list of available types), <A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A>,  <A href="../../../../../docs/manualpages/Mat/MATIS.html#MATIS">MATIS</A></font>
<a name="line1727">1727: </a><font color="#B22222">M*/</font>

<a name="line1731">1731: </a><strong><font color="#4169E1"><a name="PCCreate_BDDC"></a>PETSC_EXTERN <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A> PCCreate_BDDC(<A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> pc)</font></strong>
<a name="line1732">1732: </a>{
<a name="line1733">1733: </a>  <A href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</A>      ierr;
<a name="line1734">1734: </a>  PC_BDDC             *pcbddc;

<a name="line1737">1737: </a>  <font color="#B22222">/* Creates the private data structure for this preconditioner and attach it to the <A href="../../../../../docs/manualpages/PC/PC.html#PC">PC</A> object. */</font>
<a name="line1738">1738: </a>  <A href="../../../../../docs/manualpages/Sys/PetscNewLog.html#PetscNewLog">PetscNewLog</A>(pc,&amp;pcbddc);
<a name="line1739">1739: </a>  pc-&gt;data  = (void*)pcbddc;

<a name="line1741">1741: </a>  <font color="#B22222">/* create PCIS data structure */</font>
<a name="line1742">1742: </a>  PCISCreate(pc);

<a name="line1744">1744: </a>  <font color="#B22222">/* BDDC customization */</font>
<a name="line1745">1745: </a>  pcbddc-&gt;use_local_adj       = <A href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</A>;
<a name="line1746">1746: </a>  pcbddc-&gt;use_vertices        = <A href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</A>;
<a name="line1747">1747: </a>  pcbddc-&gt;use_edges           = <A href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</A>;
<a name="line1748">1748: </a>  pcbddc-&gt;use_faces           = <A href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</A>;
<a name="line1749">1749: </a>  pcbddc-&gt;use_change_of_basis = <A href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</A>;
<a name="line1750">1750: </a>  pcbddc-&gt;use_change_on_faces = <A href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</A>;
<a name="line1751">1751: </a>  pcbddc-&gt;switch_static       = <A href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</A>;
<a name="line1752">1752: </a>  pcbddc-&gt;use_nnsp_true       = <A href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</A>; <font color="#B22222">/* not yet exposed */</font>
<a name="line1753">1753: </a>  pcbddc-&gt;dbg_flag            = 0;
<a name="line1754">1754: </a>  <font color="#B22222">/* private */</font>
<a name="line1755">1755: </a>  pcbddc-&gt;issym                      = <A href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</A>;
<a name="line1756">1756: </a>  pcbddc-&gt;BtoNmap                    = 0;
<a name="line1757">1757: </a>  pcbddc-&gt;local_primal_size          = 0;
<a name="line1758">1758: </a>  pcbddc-&gt;n_vertices                 = 0;
<a name="line1759">1759: </a>  pcbddc-&gt;n_actual_vertices          = 0;
<a name="line1760">1760: </a>  pcbddc-&gt;n_constraints              = 0;
<a name="line1761">1761: </a>  pcbddc-&gt;primal_indices_local_idxs  = 0;
<a name="line1762">1762: </a>  pcbddc-&gt;recompute_topography       = <A href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</A>;
<a name="line1763">1763: </a>  pcbddc-&gt;coarse_size                = -1;
<a name="line1764">1764: </a>  pcbddc-&gt;new_primal_space           = <A href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</A>;
<a name="line1765">1765: </a>  pcbddc-&gt;new_primal_space_local     = <A href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</A>;
<a name="line1766">1766: </a>  pcbddc-&gt;global_primal_indices      = 0;
<a name="line1767">1767: </a>  pcbddc-&gt;onearnullspace             = 0;
<a name="line1768">1768: </a>  pcbddc-&gt;onearnullvecs_state        = 0;
<a name="line1769">1769: </a>  pcbddc-&gt;user_primal_vertices       = 0;
<a name="line1770">1770: </a>  pcbddc-&gt;NullSpace                  = 0;
<a name="line1771">1771: </a>  pcbddc-&gt;temp_solution              = 0;
<a name="line1772">1772: </a>  pcbddc-&gt;original_rhs               = 0;
<a name="line1773">1773: </a>  pcbddc-&gt;local_mat                  = 0;
<a name="line1774">1774: </a>  pcbddc-&gt;ChangeOfBasisMatrix        = 0;
<a name="line1775">1775: </a>  pcbddc-&gt;user_ChangeOfBasisMatrix   = 0;
<a name="line1776">1776: </a>  pcbddc-&gt;coarse_vec                 = 0;
<a name="line1777">1777: </a>  pcbddc-&gt;coarse_rhs                 = 0;
<a name="line1778">1778: </a>  pcbddc-&gt;coarse_ksp                 = 0;
<a name="line1779">1779: </a>  pcbddc-&gt;coarse_phi_B               = 0;
<a name="line1780">1780: </a>  pcbddc-&gt;coarse_phi_D               = 0;
<a name="line1781">1781: </a>  pcbddc-&gt;coarse_psi_B               = 0;
<a name="line1782">1782: </a>  pcbddc-&gt;coarse_psi_D               = 0;
<a name="line1783">1783: </a>  pcbddc-&gt;vec1_P                     = 0;
<a name="line1784">1784: </a>  pcbddc-&gt;vec1_R                     = 0;
<a name="line1785">1785: </a>  pcbddc-&gt;vec2_R                     = 0;
<a name="line1786">1786: </a>  pcbddc-&gt;local_auxmat1              = 0;
<a name="line1787">1787: </a>  pcbddc-&gt;local_auxmat2              = 0;
<a name="line1788">1788: </a>  pcbddc-&gt;R_to_B                     = 0;
<a name="line1789">1789: </a>  pcbddc-&gt;R_to_D                     = 0;
<a name="line1790">1790: </a>  pcbddc-&gt;ksp_D                      = 0;
<a name="line1791">1791: </a>  pcbddc-&gt;ksp_R                      = 0;
<a name="line1792">1792: </a>  pcbddc-&gt;NeumannBoundaries          = 0;
<a name="line1793">1793: </a>  pcbddc-&gt;NeumannBoundariesLocal     = 0;
<a name="line1794">1794: </a>  pcbddc-&gt;DirichletBoundaries        = 0;
<a name="line1795">1795: </a>  pcbddc-&gt;DirichletBoundariesLocal   = 0;
<a name="line1796">1796: </a>  pcbddc-&gt;user_provided_isfordofs    = <A href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</A>;
<a name="line1797">1797: </a>  pcbddc-&gt;n_ISForDofs                = 0;
<a name="line1798">1798: </a>  pcbddc-&gt;n_ISForDofsLocal           = 0;
<a name="line1799">1799: </a>  pcbddc-&gt;ISForDofs                  = 0;
<a name="line1800">1800: </a>  pcbddc-&gt;ISForDofsLocal             = 0;
<a name="line1801">1801: </a>  pcbddc-&gt;ConstraintMatrix           = 0;
<a name="line1802">1802: </a>  pcbddc-&gt;use_exact_dirichlet_trick  = <A href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</A>;
<a name="line1803">1803: </a>  pcbddc-&gt;coarse_loc_to_glob         = 0;
<a name="line1804">1804: </a>  pcbddc-&gt;coarsening_ratio           = 8;
<a name="line1805">1805: </a>  pcbddc-&gt;current_level              = 0;
<a name="line1806">1806: </a>  pcbddc-&gt;max_levels                 = 0;
<a name="line1807">1807: </a>  pcbddc-&gt;use_coarse_estimates       = <A href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</A>;
<a name="line1808">1808: </a>  pcbddc-&gt;coarse_subassembling       = 0;
<a name="line1809">1809: </a>  pcbddc-&gt;coarse_subassembling_init  = 0;

<a name="line1811">1811: </a>  <font color="#B22222">/* create local graph structure */</font>
<a name="line1812">1812: </a>  PCBDDCGraphCreate(&amp;pcbddc-&gt;mat_graph);

<a name="line1814">1814: </a>  <font color="#B22222">/* scaling */</font>
<a name="line1815">1815: </a>  pcbddc-&gt;use_deluxe_scaling         = <A href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</A>;
<a name="line1816">1816: </a>  pcbddc-&gt;deluxe_ctx                 = 0;
<a name="line1817">1817: </a>  pcbddc-&gt;work_scaling               = 0;

<a name="line1819">1819: </a>  <font color="#B22222">/* function pointers */</font>
<a name="line1820">1820: </a>  pc-&gt;ops-&gt;apply               = PCApply_BDDC;
<a name="line1821">1821: </a>  pc-&gt;ops-&gt;applytranspose      = PCApplyTranspose_BDDC;
<a name="line1822">1822: </a>  pc-&gt;ops-&gt;setup               = PCSetUp_BDDC;
<a name="line1823">1823: </a>  pc-&gt;ops-&gt;destroy             = PCDestroy_BDDC;
<a name="line1824">1824: </a>  pc-&gt;ops-&gt;setfromoptions      = PCSetFromOptions_BDDC;
<a name="line1825">1825: </a>  pc-&gt;ops-&gt;view                = 0;
<a name="line1826">1826: </a>  pc-&gt;ops-&gt;applyrichardson     = 0;
<a name="line1827">1827: </a>  pc-&gt;ops-&gt;applysymmetricleft  = 0;
<a name="line1828">1828: </a>  pc-&gt;ops-&gt;applysymmetricright = 0;
<a name="line1829">1829: </a>  pc-&gt;ops-&gt;presolve            = PCPreSolve_BDDC;
<a name="line1830">1830: </a>  pc-&gt;ops-&gt;postsolve           = PCPostSolve_BDDC;

<a name="line1832">1832: </a>  <font color="#B22222">/* composing function */</font>
<a name="line1833">1833: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCSetChangeOfBasisLocalMat_C"</font>,PCBDDCSetChangeOfBasisLocalMat_BDDC);
<a name="line1834">1834: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCSetPrimalVerticesLocalIS_C"</font>,PCBDDCSetPrimalVerticesLocalIS_BDDC);
<a name="line1835">1835: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCSetCoarseningRatio_C"</font>,PCBDDCSetCoarseningRatio_BDDC);
<a name="line1836">1836: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCSetLevel_C"</font>,PCBDDCSetLevel_BDDC);
<a name="line1837">1837: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCSetUseExactDirichlet_C"</font>,PCBDDCSetUseExactDirichlet_BDDC);
<a name="line1838">1838: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCSetLevels_C"</font>,PCBDDCSetLevels_BDDC);
<a name="line1839">1839: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCSetNullSpace_C"</font>,PCBDDCSetNullSpace_BDDC);
<a name="line1840">1840: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCSetDirichletBoundaries_C"</font>,PCBDDCSetDirichletBoundaries_BDDC);
<a name="line1841">1841: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCSetDirichletBoundariesLocal_C"</font>,PCBDDCSetDirichletBoundariesLocal_BDDC);
<a name="line1842">1842: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCSetNeumannBoundaries_C"</font>,PCBDDCSetNeumannBoundaries_BDDC);
<a name="line1843">1843: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCSetNeumannBoundariesLocal_C"</font>,PCBDDCSetNeumannBoundariesLocal_BDDC);
<a name="line1844">1844: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCGetDirichletBoundaries_C"</font>,PCBDDCGetDirichletBoundaries_BDDC);
<a name="line1845">1845: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCGetDirichletBoundariesLocal_C"</font>,PCBDDCGetDirichletBoundariesLocal_BDDC);
<a name="line1846">1846: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCGetNeumannBoundaries_C"</font>,PCBDDCGetNeumannBoundaries_BDDC);
<a name="line1847">1847: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCGetNeumannBoundariesLocal_C"</font>,PCBDDCGetNeumannBoundariesLocal_BDDC);
<a name="line1848">1848: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCSetDofsSplitting_C"</font>,PCBDDCSetDofsSplitting_BDDC);
<a name="line1849">1849: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCSetDofsSplittingLocal_C"</font>,PCBDDCSetDofsSplittingLocal_BDDC);
<a name="line1850">1850: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCSetLocalAdjacencyGraph_C"</font>,PCBDDCSetLocalAdjacencyGraph_BDDC);
<a name="line1851">1851: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCCreateFETIDPOperators_C"</font>,PCBDDCCreateFETIDPOperators_BDDC);
<a name="line1852">1852: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCMatFETIDPGetRHS_C"</font>,PCBDDCMatFETIDPGetRHS_BDDC);
<a name="line1853">1853: </a>  <A href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</A>((<A href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</A>)pc,<font color="#666666">"PCBDDCMatFETIDPGetSolution_C"</font>,PCBDDCMatFETIDPGetSolution_BDDC);
<a name="line1854">1854: </a>  <font color="#4169E1">return</font>(0);
<a name="line1855">1855: </a>}

</pre>
</body>

</html>
